<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­å»ºä¼ä¸šçº§ç›‘æ§å‘Šè­¦ç³»ç»Ÿ | è¿ç»´å®æˆ˜</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans SC", sans-serif;
            line-height: 1.7;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light {
            background-color: #f8fafc;
            color: #1f2937;
        }

        body.dark {
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        body.light .navbar {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .navbar {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            align-items: center;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 8px;
        }

        body.light .nav-menu a {
            color: #4b5563;
        }

        body.dark .nav-menu a {
            color: #cbd5e1;
        }

        body.light .nav-menu a:hover {
            color: #6366f1;
            background: #f3f4f6;
        }

        body.dark .nav-menu a:hover {
            color: #a78bfa;
            background: #1e293b;
        }

        .theme-toggle {
            width: 50px;
            height: 26px;
            border-radius: 13px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        body.light .theme-toggle {
            background: #e5e7eb;
        }

        body.dark .theme-toggle {
            background: #6366f1;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            background: white;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        body.dark .theme-toggle::before {
            transform: translateX(24px);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            max-width: 900px;
            margin: 100px auto 60px;
            padding: 0 20px;
        }

        /* è¿”å›æŒ‰é’® */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        /* æ–‡ç« å¤´éƒ¨ */
        .article-header {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid;
        }

        body.light .article-header {
            border-color: #e5e7eb;
        }

        body.dark .article-header {
            border-color: #334155;
        }

        .article-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        body.light .article-title {
            color: #1f2937;
        }

        body.dark .article-title {
            color: #f1f5f9;
        }

        .article-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
        }

        body.light .article-meta {
            color: #6b7280;
        }

        body.dark .article-meta {
            color: #94a3b8;
        }

        .article-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 13px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .article-intro {
            font-size: 16px;
            line-height: 1.8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 40px;
        }

        body.light .article-intro {
            background: #f8fafc;
            color: #475569;
        }

        body.dark .article-intro {
            background: #1e293b;
            color: #cbd5e1;
        }

        /* ç›®å½• */
        .toc {
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 40px;
            border-left: 4px solid #6366f1;
        }

        body.light .toc {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .toc {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .toc h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        body.light .toc h4 {
            color: #1f2937;
        }

        body.dark .toc h4 {
            color: #f1f5f9;
        }

        .toc ul {
            list-style: none;
            display: grid;
            gap: 10px;
        }

        .toc li a {
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s;
            display: block;
        }

        body.light .toc li a {
            color: #4b5563;
        }

        body.dark .toc li a {
            color: #cbd5e1;
        }

        body.light .toc li a:hover {
            color: #6366f1;
            background: #f3f4f6;
            transform: translateX(4px);
        }

        body.dark .toc li a:hover {
            color: #a78bfa;
            background: #0f172a;
            transform: translateX(4px);
        }

        /* ç›®å½•æ¿€æ´»çŠ¶æ€ */
        .toc li a.active {
            color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            font-weight: 600;
            transform: translateX(8px);
        }

        body.dark .toc li a.active {
            color: #a78bfa;
            background: rgba(167, 139, 250, 0.1);
        }

        /* å†…å®¹åŒºå— */
        .content-section {
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        body.light .content-section {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .content-section {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .content-section:hover {
            transform: translateY(-2px);
        }

        body.light .content-section:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark .content-section:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid;
        }

        body.light h2 {
            color: #6366f1;
            border-color: rgba(99, 102, 241, 0.2);
        }

        body.dark h2 {
            color: #a78bfa;
            border-color: rgba(167, 139, 250, 0.2);
        }

        h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 24px 0 16px;
        }

        body.light h3 {
            color: #1f2937;
        }

        body.dark h3 {
            color: #f1f5f9;
        }

        p {
            margin-bottom: 16px;
            font-size: 15px;
            line-height: 1.8;
        }

        ul, ol {
            margin: 16px 0 16px 24px;
            line-height: 1.8;
        }

        li {
            margin-bottom: 10px;
            font-size: 15px;
        }

        strong {
            font-weight: 600;
        }

        body.light strong {
            color: #1f2937;
        }

        body.dark strong {
            color: #f1f5f9;
        }

        /* ä»£ç å— */
        .code-container {
            position: relative;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        pre {
            padding: 24px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid #6366f1;
        }

        body.light pre {
            background: #f1f5f9;
        }

        body.dark pre {
            background: #0f172a;
        }

        code {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        body.light code {
            color: #dc2626;
            background: #f1f5f9;
        }

        body.dark code {
            color: #f87171;
            background: #1e293b;
        }

        /* ä»£ç è¯­æ³•é«˜äº® */
        .keyword { color: #6366f1; font-weight: bold; }
        .string { color: #3b82f6; }
        .constant { color: #8b5cf6; }
        .comment { color: #6b7280; font-style: italic; }

        body.dark .keyword { color: #a78bfa; }
        body.dark .string { color: #60a5fa; }
        body.dark .constant { color: #c4b5fd; }
        body.dark .comment { color: #94a3b8; }

        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 8px 16px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #4f46e5;
        }

        .copy-btn.copied {
            background: #10b981;
        }

        /* ä¿¡æ¯æç¤º */
        .info-tip {
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        body.light .info-tip {
            background: rgba(59, 130, 246, 0.1);
        }

        body.dark .info-tip {
            background: rgba(59, 130, 246, 0.15);
        }

        .info-tip strong {
            color: #3b82f6;
            display: block;
            margin-bottom: 8px;
        }

        /* è­¦å‘Šæç¤º */
        .warning-tip {
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        body.light .warning-tip {
            background: rgba(245, 158, 11, 0.1);
        }

        body.dark .warning-tip {
            background: rgba(245, 158, 11, 0.15);
        }

        .warning-tip strong {
            color: #f59e0b;
            display: block;
            margin-bottom: 8px;
        }

        /* æˆåŠŸæç¤º */
        .success-tip {
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }

        body.light .success-tip {
            background: rgba(16, 185, 129, 0.1);
        }

        body.dark .success-tip {
            background: rgba(16, 185, 129, 0.15);
        }

        .success-tip strong {
            color: #10b981;
            display: block;
            margin-bottom: 8px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .monitoring-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .monitoring-table th, .monitoring-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid;
        }

        body.light .monitoring-table th {
            background: #f1f5f9;
            color: #1f2937;
            border-color: #e5e7eb;
        }

        body.dark .monitoring-table th {
            background: #0f172a;
            color: #f1f5f9;
            border-color: #334155;
        }

        body.light .monitoring-table td {
            border-color: #e5e7eb;
        }

        body.dark .monitoring-table td {
            border-color: #334155;
        }

        /* ç‰¹æ€§å¡ç‰‡ */
        .monitoring-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .monitoring-card {
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        body.light .monitoring-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
        }

        body.dark .monitoring-card {
            background: #0f172a;
            border: 1px solid #334155;
        }

        .monitoring-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body.dark .monitoring-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .monitoring-card h4 {
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6366f1;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .article-title {
                font-size: 28px;
            }

            .content-section {
                padding: 20px;
            }

            pre {
                padding: 16px;
                font-size: 13px;
            }

            .copy-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .monitoring-table th, .monitoring-table td {
                padding: 8px 10px;
                font-size: 14px;
            }

            .monitoring-cards {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0 16px;
            }

            .toc {
                padding: 16px;
            }

            .article-title {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            h3 {
                font-size: 18px;
            }

            .monitoring-table {
                font-size: 13px;
            }
        }

        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #6366f1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
            z-index: 999;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: #4f46e5;
            transform: translateY(-2px);
        }

        /* æ¶æ„å›¾æ ·å¼ */
        .architecture-diagram {
            margin: 25px 0;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        body.light .architecture-diagram {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
        }

        body.dark .architecture-diagram {
            background: #1e293b;
            border: 1px solid #334155;
        }

        .architecture-layer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
        }

        .layer-box {
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: 600;
            margin: 8px 0;
            width: 80%;
            text-align: center;
        }

        body.light .layer-box {
            background: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        body.dark .layer-box {
            background: #0f172a;
            border: 1px solid #334155;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .layer-arrow {
            font-size: 20px;
            color: #6366f1;
            margin: 5px 0;
        }

        body.dark .layer-arrow {
            color: #a78bfa;
        }

        /* æŒ‡æ ‡å¡ç‰‡ */
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s;
        }

        body.light .metric-card {
            background: white;
            border: 1px solid #e5e7eb;
        }

        body.dark .metric-card {
            background: #0f172a;
            border: 1px solid #334155;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #6366f1;
        }

        body.dark .metric-value {
            color: #a78bfa;
        }

        .metric-label {
            font-size: 14px;
            color: #6b7280;
        }

        body.dark .metric-label {
            color: #94a3b8;
        }

        /* å‘Šè­¦çº§åˆ« */
        .alert-levels {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .alert-level {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .alert-critical {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fca5a5;
        }

        body.dark .alert-critical {
            background: rgba(220, 38, 38, 0.2);
            color: #f87171;
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .alert-warning {
            background: #fef3c7;
            color: #d97706;
            border: 1px solid #fbbf24;
        }

        body.dark .alert-warning {
            background: rgba(217, 119, 6, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .alert-info {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #93c5fd;
        }

        body.dark .alert-info {
            background: rgba(29, 78, 216, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(147, 197, 253, 0.3);
        }

        /* æ—¶é—´çº¿ */
        .timeline {
            position: relative;
            margin: 25px 0;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #6366f1;
        }

        body.dark .timeline::before {
            background: #a78bfa;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
            border: 2px solid white;
        }

        body.dark .timeline-item::before {
            background: #a78bfa;
            border: 2px solid #1e293b;
        }

        .timeline-date {
            font-weight: 600;
            margin-bottom: 5px;
            color: #6366f1;
        }

        body.dark .timeline-date {
            color: #a78bfa;
        }

        /* æ¯”è¾ƒè¡¨æ ¼ */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .comparison-table th {
            padding: 14px 16px;
            text-align: center;
            background: #6366f1;
            color: white;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 12px 16px;
            text-align: center;
            border-bottom: 1px solid;
        }

        body.light .comparison-table td {
            border-color: #e5e7eb;
        }

        body.dark .comparison-table td {
            border-color: #334155;
        }

        .comparison-yes {
            color: #10b981;
            font-weight: bold;
        }

        .comparison-no {
            color: #ef4444;
        }

        .comparison-partial {
            color: #f59e0b;
        }
    </style>
</head>
<body class="dark">
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">è¿ç»´å®æˆ˜</a>
            <ul class="nav-menu">
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="../index.html#projects">é¡¹ç›®æ¡ˆä¾‹</a></li>
                <li><a href="../index.html#experience">å·¥ä½œç»å†</a></li>
                <li><a href="../pages/articles.html">æŠ€æœ¯æ–‡ç« </a></li>
                <li><a href="../pages/about.html">å…³äºæˆ‘</a></li>
            </ul>
            <div class="theme-toggle" onclick="toggleTheme()"></div>
        </div>
    </nav>

    <main class="main-content">
        <!-- è¿”å›æŒ‰é’® -->
        <a href="../pages/articles.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
            <span>è¿”å›æ–‡ç« åˆ—è¡¨</span>
        </a>

        <!-- æ–‡ç« å¤´éƒ¨ -->
        <div class="article-header">
            <h1 class="article-title">æ­å»ºä¼ä¸šçº§ç›‘æ§å‘Šè­¦ç³»ç»Ÿ</h1>
            <div class="article-meta">
                <span class="category-badge">è¿ç»´å®æˆ˜</span>
                <span><i class="far fa-calendar"></i> 2025-12-08</span>
                <span><i class="far fa-clock"></i> é˜…è¯» 9 åˆ†é’Ÿ</span>
                <span><i class="far fa-eye"></i> 2345 æ¬¡æµè§ˆ</span>
            </div>
        </div>

        <!-- æ–‡ç« ç®€ä»‹ -->
        <div class="article-intro">
            æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Prometheuså’ŒGrafanaä»é›¶å¼€å§‹æ­å»ºä¸€å¥—å®Œæ•´çš„ä¼ä¸šçº§ç›‘æ§å‘Šè­¦ç³»ç»Ÿã€‚å†…å®¹åŒ…æ‹¬ï¼šç›‘æ§ä½“ç³»è®¾è®¡ã€Prometheuså®‰è£…ä¸é…ç½®ã€Exporteréƒ¨ç½²ã€Grafanaä»ªè¡¨æ¿è®¾è®¡ã€å‘Šè­¦è§„åˆ™é…ç½®ã€é€šçŸ¥æ¸ é“é›†æˆï¼ˆé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰ï¼Œä»¥åŠç”Ÿäº§ç¯å¢ƒä¼˜åŒ–å»ºè®®ã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å°†èƒ½å¤Ÿæ„å»ºä¸€å¥—å…·å¤‡é«˜å¯ç”¨æ€§å’Œæ‰©å±•æ€§çš„ç›‘æ§ä½“ç³»ï¼Œæ»¡è¶³ä¼ä¸šITç³»ç»Ÿçš„å¯è§‚æµ‹æ€§éœ€æ±‚ã€‚
        </div>

        <!-- ç›®å½• -->
        <div class="toc">
            <h4>ğŸ“‹ æ–‡ç« ç›®å½•</h4>
            <ul>
                <li><a href="#overview">ä¸€ã€ç›‘æ§ä½“ç³»æ¦‚è¿°ä¸è®¾è®¡åŸåˆ™</a></li>
                <li><a href="#architecture">äºŒã€ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡</a></li>
                <li><a href="#prometheus">ä¸‰ã€Prometheuséƒ¨ç½²ä¸é…ç½®</a></li>
                <li><a href="#exporters">å››ã€å„ç§Exporteréƒ¨ç½²</a></li>
                <li><a href="#grafana">äº”ã€Grafanaå¯è§†åŒ–ä¸ä»ªè¡¨æ¿</a></li>
                <li><a href="#alerting">å…­ã€å‘Šè­¦è§„åˆ™ä¸é€šçŸ¥é…ç½®</a></li>
                <li><a href="#high-availability">ä¸ƒã€é«˜å¯ç”¨ä¸ç”Ÿäº§ä¼˜åŒ–</a></li>
                <li><a href="#summary">å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</a></li>
            </ul>
        </div>

        <!-- ç›‘æ§ä½“ç³»æ¦‚è¿°ä¸è®¾è®¡åŸåˆ™ -->
        <section class="content-section" id="overview">
            <h2>ä¸€ã€ç›‘æ§ä½“ç³»æ¦‚è¿°ä¸è®¾è®¡åŸåˆ™</h2>
            
            <h3>1. ç›‘æ§çš„é‡è¦æ€§ä¸ä»·å€¼</h3>
            <p>åœ¨ç°ä»£åŒ–çš„ITç³»ç»Ÿä¸­ï¼Œç›‘æ§å·²ç»ä»ä¸€ä¸ª"å¯é€‰é¡¹"å˜æˆäº†"å¿…é€‰é¡¹"ã€‚ä¸€ä¸ªå®Œå–„çš„ç›‘æ§ä½“ç³»èƒ½å¤Ÿï¼š</p>
            
            <div class="monitoring-cards">
                <div class="monitoring-card">
                    <h4><i class="fas fa-search"></i> å¿«é€Ÿå‘ç°é—®é¢˜</h4>
                    <p>å®æ—¶å‘ç°ç³»ç»Ÿå¼‚å¸¸ï¼Œé¿å…å°é—®é¢˜æ¼”å˜æˆå¤§æ•…éšœã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-chart-line"></i> æ€§èƒ½ä¼˜åŒ–ä¾æ®</h4>
                    <p>é€šè¿‡å†å²æ•°æ®åˆ†æç³»ç»Ÿç“¶é¢ˆï¼ŒæŒ‡å¯¼å®¹é‡è§„åˆ’å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-history"></i> æ•…éšœå›æº¯åˆ†æ</h4>
                    <p>è®°å½•ç³»ç»Ÿå†å²çŠ¶æ€ï¼Œä¾¿äºæ•…éšœåŸå› åˆ†æå’Œè´£ä»»è¿½æº¯ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-user-check"></i> SLAä¿éšœ</h4>
                    <p>é‡åŒ–æœåŠ¡å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œä¸ºSLAï¼ˆæœåŠ¡ç­‰çº§åè®®ï¼‰æä¾›æ•°æ®æ”¯æŒã€‚</p>
                </div>
            </div>

            <div class="warning-tip">
                <strong>ğŸ“Š ç›‘æ§æ•°æ®ä»·å€¼ï¼š</strong>
                <p>æ ¹æ®Google SREï¼ˆç«™ç‚¹å¯é æ€§å·¥ç¨‹ï¼‰çš„ç»éªŒï¼Œæœ‰æ•ˆçš„ç›‘æ§å¯ä»¥å°†MTTRï¼ˆå¹³å‡ä¿®å¤æ—¶é—´ï¼‰é™ä½70%ä»¥ä¸Šï¼Œå¹¶å°†æ•…éšœé¢„æµ‹å‡†ç¡®ç‡æå‡åˆ°85%ä»¥ä¸Šã€‚</p>
            </div>

            <h3>2. ç›‘æ§è®¾è®¡åŸåˆ™ï¼ˆGoogleå››å¤§é»„é‡‘æŒ‡æ ‡ï¼‰</h3>
            <p>Google SREå›¢é˜Ÿæå‡ºçš„å››å¤§é»„é‡‘æŒ‡æ ‡æ˜¯ç›‘æ§è®¾è®¡çš„æ ¸å¿ƒæŒ‡å¯¼åŸåˆ™ï¼š</p>
            
            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-value">å»¶è¿Ÿ</div>
                    <div class="metric-label">Latency</div>
                    <p>æœåŠ¡å¤„ç†è¯·æ±‚æ‰€éœ€æ—¶é—´</p>
                </div>
                <div class="metric-card">
                    <div class="metric-value">æµé‡</div>
                    <div class="metric-label">Traffic</div>
                    <p>ç³»ç»Ÿæ‰¿è½½çš„è¯·æ±‚é‡æˆ–å¹¶å‘é‡</p>
                </div>
                <div class="metric-card">
                    <div class="metric-value">é”™è¯¯ç‡</div>
                    <div class="metric-label">Errors</div>
                    <p>è¯·æ±‚å¤±è´¥æˆ–é”™è¯¯çš„æ¯”ä¾‹</p>
                </div>
                <div class="metric-card">
                    <div class="metric-value">é¥±å’Œåº¦</div>
                    <div class="metric-label">Saturation</div>
                    <p>ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç¨‹åº¦</p>
                </div>
            </div>

            <h3>3. ç›‘æ§å±‚çº§åˆ’åˆ†</h3>
            <p>å…¨é¢çš„ç›‘æ§ä½“ç³»åº”è¯¥è¦†ç›–ä»¥ä¸‹å››ä¸ªå±‚çº§ï¼š</p>
            
            <div class="architecture-diagram">
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #4f46e5; color: white;">
                        <i class="fas fa-globe"></i> ä¸šåŠ¡ç›‘æ§
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #7c3aed; color: white;">
                        <i class="fas fa-cube"></i> åº”ç”¨ç›‘æ§
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #8b5cf6; color: white;">
                        <i class="fas fa-server"></i> ç³»ç»Ÿç›‘æ§
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #a78bfa; color: white;">
                        <i class="fas fa-network-wired"></i> ç½‘ç»œç›‘æ§
                    </div>
                </div>
            </div>

            <div class="info-tip">
                <strong>ğŸ” ç›‘æ§è¦†ç›–åº¦æ£€æŸ¥æ¸…å•ï¼š</strong>
                <p>1. <strong>ä¸šåŠ¡æŒ‡æ ‡</strong>ï¼šå…³é”®ä¸šåŠ¡æµç¨‹æˆåŠŸç‡ã€ç”¨æˆ·æ´»è·ƒåº¦ã€è®¢å•é‡ç­‰<br>
                2. <strong>åº”ç”¨æŒ‡æ ‡</strong>ï¼šåº”ç”¨å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€ååé‡ã€JVM/GCçŠ¶æ€ç­‰<br>
                3. <strong>ç³»ç»ŸæŒ‡æ ‡</strong>ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œä½¿ç”¨ç‡ã€è¿›ç¨‹çŠ¶æ€ç­‰<br>
                4. <strong>ç½‘ç»œæŒ‡æ ‡</strong>ï¼šç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ç‡ã€å¸¦å®½ä½¿ç”¨ç‡ã€è¿æ¥æ•°ç­‰</p>
            </div>
        </section>

        <!-- ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡ -->
        <section class="content-section" id="architecture">
            <h2>äºŒã€ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
            
            <div class="success-tip">
                <strong>ğŸ¯ æ¶æ„è®¾è®¡ç›®æ ‡ï¼š</strong>
                <p>1. <strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒç›‘æ§ä¸Šåƒä¸ªèŠ‚ç‚¹<br>
                2. <strong>é«˜å¯ç”¨æ€§</strong>ï¼šç›‘æ§ç³»ç»Ÿè‡ªèº«ä¸èƒ½æˆä¸ºå•ç‚¹æ•…éšœ<br>
                3. <strong>å®æ—¶æ€§</strong>ï¼šæŒ‡æ ‡é‡‡é›†å’Œå‘Šè­¦å»¶è¿Ÿåœ¨ç§’çº§<br>
                4. <strong>æ˜“ç”¨æ€§</strong>ï¼šé…ç½®ç®€å•ï¼Œå¯è§†åŒ–å‹å¥½ï¼Œä¾¿äºé—®é¢˜å®šä½</p>
            </div>

            <h3>1. æ•´ä½“æ¶æ„è®¾è®¡</h3>
            <p>ä¼ä¸šçº§ç›‘æ§ç³»ç»Ÿé€šå¸¸é‡‡ç”¨ä»¥ä¸‹æ¶æ„ï¼š</p>
            
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">æŸ¥çœ‹æ¶æ„</button>
                <pre><code># ä¼ä¸šçº§ç›‘æ§ç³»ç»Ÿæ¶æ„

"""
æ•°æ®é‡‡é›†å±‚ (Data Collection)
â”œâ”€â”€ Node Exporter: æœåŠ¡å™¨åŸºç¡€æŒ‡æ ‡
â”œâ”€â”€ MySQL Exporter: æ•°æ®åº“ç›‘æ§
â”œâ”€â”€ Nginx Exporter: WebæœåŠ¡å™¨ç›‘æ§
â”œâ”€â”€ JMX Exporter: Javaåº”ç”¨ç›‘æ§
â”œâ”€â”€ Blackbox Exporter: ç½‘ç»œæ¢æµ‹
â””â”€â”€ è‡ªå®šä¹‰Exporter: ä¸šåŠ¡æŒ‡æ ‡é‡‡é›†

æ•°æ®å­˜å‚¨ä¸å¤„ç†å±‚ (Storage & Processing)
â”œâ”€â”€ Prometheus Server: æŒ‡æ ‡é‡‡é›†ã€å­˜å‚¨ã€æŸ¥è¯¢
â”œâ”€â”€ Prometheus Alertmanager: å‘Šè­¦ç®¡ç†
â”œâ”€â”€ Thanos/Cortex: é•¿æœŸå­˜å‚¨å’Œé›†ç¾¤æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰
â””â”€â”€ æ—¶åºæ•°æ®åº“: VictoriaMetrics/InfluxDBï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰

æ•°æ®å¯è§†åŒ–å±‚ (Visualization)
â”œâ”€â”€ Grafana: ä»ªè¡¨æ¿å±•ç¤º
â”œâ”€â”€ è‡ªå®šä¹‰Dashboard: ä¸šåŠ¡å¤§å±
â””â”€â”€ æŠ¥è¡¨ç³»ç»Ÿ: å®šæœŸæŠ¥å‘Šç”Ÿæˆ

å‘Šè­¦é€šçŸ¥å±‚ (Alerting & Notification)
â”œâ”€â”€ é‚®ä»¶é€šçŸ¥: SMTPé›†æˆ
â”œâ”€â”€ å³æ—¶é€šè®¯: é’‰é’‰/ä¼ä¸šå¾®ä¿¡/Slack
â”œâ”€â”€ çŸ­ä¿¡é€šçŸ¥: äº‘æœåŠ¡å•†API
â””â”€â”€ ç”µè¯å‘Šè­¦: ç´§æ€¥æƒ…å†µè‡ªåŠ¨å‘¼å«

è¾…åŠ©ç»„ä»¶ (Auxiliary Components)
â”œâ”€â”€ Service Discovery: è‡ªåŠ¨å‘ç°ç›‘æ§ç›®æ ‡
â”œâ”€â”€ é…ç½®ç®¡ç†: Ansible/Terraformè‡ªåŠ¨åŒ–éƒ¨ç½²
â”œâ”€â”€ æƒé™æ§åˆ¶: LDAP/OAuth2é›†æˆ
â””â”€â”€ æ—¥å¿—é›†æˆ: Loki/ELK Stackå…³è”åˆ†æ
"""</code></pre>
            </div>

            <h3>2. æŠ€æœ¯é€‰å‹å¯¹æ¯”</h3>
            <p>ä¸»æµç›‘æ§è§£å†³æ–¹æ¡ˆå¯¹æ¯”ï¼š</p>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>Prometheus</th>
                        <th>Zabbix</th>
                        <th>Nagios</th>
                        <th>DataDog</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>å¼€æº/å•†ä¸š</strong></td>
                        <td class="comparison-yes">å¼€æº</td>
                        <td class="comparison-yes">å¼€æº</td>
                        <td class="comparison-yes">å¼€æº</td>
                        <td class="comparison-no">å•†ä¸š</td>
                    </tr>
                    <tr>
                        <td><strong>æ•°æ®æ¨¡å‹</strong></td>
                        <td class="comparison-yes">å¤šç»´æ—¶åºæ•°æ®</td>
                        <td class="comparison-partial">é”®å€¼å¯¹</td>
                        <td class="comparison-partial">çŠ¶æ€æ£€æŸ¥</td>
                        <td class="comparison-yes">å¤šç»´æ—¶åºæ•°æ®</td>
                    </tr>
                    <tr>
                        <td><strong>æŸ¥è¯¢è¯­è¨€</strong></td>
                        <td class="comparison-yes">PromQL</td>
                        <td class="comparison-no">æœ‰é™</td>
                        <td class="comparison-no">æ— </td>
                        <td class="comparison-yes">ä¸“æœ‰æŸ¥è¯¢</td>
                    </tr>
                    <tr>
                        <td><strong>æœåŠ¡å‘ç°</strong></td>
                        <td class="comparison-yes">åŸç”Ÿæ”¯æŒ</td>
                        <td class="comparison-partial">æœ‰é™æ”¯æŒ</td>
                        <td class="comparison-no">ä¸æ”¯æŒ</td>
                        <td class="comparison-yes">è‡ªåŠ¨å‘ç°</td>
                    </tr>
                    <tr>
                        <td><strong>å¯è§†åŒ–</strong></td>
                        <td class="comparison-partial">éœ€Grafana</td>
                        <td class="comparison-yes">å†…ç½®</td>
                        <td class="comparison-partial">éœ€æ’ä»¶</td>
                        <td class="comparison-yes">å†…ç½®</td>
                    </tr>
                    <tr>
                        <td><strong>ç¤¾åŒºç”Ÿæ€</strong></td>
                        <td class="comparison-yes">å¼ºå¤§</td>
                        <td class="comparison-yes">å¼ºå¤§</td>
                        <td class="comparison-yes">å¼ºå¤§</td>
                        <td class="comparison-no">å•†ä¸šæ”¯æŒ</td>
                    </tr>
                    <tr>
                        <td><strong>æˆæœ¬</strong></td>
                        <td class="comparison-yes">å…è´¹</td>
                        <td class="comparison-yes">å…è´¹</td>
                        <td class="comparison-yes">å…è´¹</td>
                        <td class="comparison-no">æ˜‚è´µ</td>
                    </tr>
                </tbody>
            </table>

            <h3>3. ç›‘æ§æŒ‡æ ‡è®¾è®¡è§„èŒƒ</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶è§„èŒƒ</button>
                <pre><code># ç›‘æ§æŒ‡æ ‡å‘½åè§„èŒƒ
# æ ¼å¼: {__name__}{label1="value1",label2="value2",...}

"""
å‘½åè§„èŒƒï¼š
1. ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ï¼šhttp_requests_total
2. åŸºæœ¬å‘½åæ¨¡å¼ï¼š<metric name>_<metric type>
   - _total: è®¡æ•°å™¨ç´¯åŠ å€¼
   - _count: ç›´æ–¹å›¾/æ‘˜è¦çš„è®¡æ•°
   - _sum: ç›´æ–¹å›¾/æ‘˜è¦çš„æ€»å’Œ
   - _bucket: ç›´æ–¹å›¾çš„åˆ†æ¡¶
   - _info: æä¾›å…ƒä¿¡æ¯
3. å•ä½æ ‡å‡†åŒ–ï¼š
   - æ—¶é—´: ç§’ï¼ˆsecondsï¼‰
   - å†…å­˜: å­—èŠ‚ï¼ˆbytesï¼‰
   - ç£ç›˜: å­—èŠ‚ï¼ˆbytesï¼‰
   - ç½‘ç»œ: æ¯”ç‰¹/ç§’ï¼ˆbits/secï¼‰

æ ‡ç­¾è®¾è®¡åŸåˆ™ï¼š
1. æ ‡è¯†æ€§æ ‡ç­¾ï¼ˆå¿…å¤‡ï¼‰ï¼š
   - instance: å®ä¾‹æ ‡è¯†ï¼ˆIP:Portï¼‰
   - job: ä»»åŠ¡/æœåŠ¡åç§°
   - env: ç¯å¢ƒï¼ˆprod/staging/devï¼‰

2. ç»´åº¦æ€§æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰ï¼š
   - region: åœ°åŸŸï¼ˆååŒ—/åä¸œï¼‰
   - az: å¯ç”¨åŒº
   - team: è´Ÿè´£å›¢é˜Ÿ
   - version: åº”ç”¨ç‰ˆæœ¬

3. é¿å…çš„æ ‡ç­¾è®¾è®¡ï¼š
   - ä¸è¦ä½¿ç”¨é«˜åŸºæ•°æ ‡ç­¾ï¼ˆå¦‚ç”¨æˆ·IDï¼‰
   - é¿å…æ ‡ç­¾å€¼åŠ¨æ€å˜åŒ–
   - æ ‡ç­¾æ•°é‡ä¸å®œè¿‡å¤šï¼ˆä¸€èˆ¬5-10ä¸ªï¼‰

ç¤ºä¾‹æŒ‡æ ‡ï¼š
# ç³»ç»ŸæŒ‡æ ‡
node_cpu_seconds_total{mode="idle", instance="192.168.1.100:9100", job="node"}
node_memory_MemFree_bytes{instance="192.168.1.100:9100", job="node"}

# åº”ç”¨æŒ‡æ ‡
http_requests_total{method="POST", endpoint="/api/users", status="200", job="user-service"}
http_request_duration_seconds_bucket{method="GET", endpoint="/api/products", le="0.1"}

# ä¸šåŠ¡æŒ‡æ ‡
orders_total{type="new", payment_method="alipay", env="production"}
user_sessions_active{region="north", platform="mobile"}
"""</code></pre>
            </div>
        </section>

        <!-- Prometheuséƒ¨ç½²ä¸é…ç½® -->
        <section class="content-section" id="prometheus">
            <h2>ä¸‰ã€Prometheuséƒ¨ç½²ä¸é…ç½®</h2>
            
            <div class="info-tip">
                <strong>ğŸš€ Prometheusç‰¹ç‚¹ï¼š</strong>
                <p>1. <strong>å¤šç»´æ•°æ®æ¨¡å‹</strong>ï¼šæŒ‡æ ‡åç§° + é”®å€¼å¯¹æ ‡ç­¾<br>
                2. <strong>å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€</strong>ï¼šPromQLï¼Œçµæ´»çš„æ•°æ®æŸ¥è¯¢å’Œèšåˆ<br>
                3. <strong>ä¸ä¾èµ–åˆ†å¸ƒå¼å­˜å‚¨</strong>ï¼šå•èŠ‚ç‚¹è‡ªåŒ…å«<br>
                4. <strong>HTTPæ‹‰å–æ¨¡å¼</strong>ï¼šä¸»åŠ¨ä»ç›®æ ‡æ‹‰å–æŒ‡æ ‡<br>
                5. <strong>å¤šç§æœåŠ¡å‘ç°</strong>ï¼šæ”¯æŒKubernetesã€Consulç­‰</p>
            </div>

            <h3>1. Prometheuså®‰è£…éƒ¨ç½²</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶è„šæœ¬</button>
                <pre><code>#!/bin/bash
# install_prometheus.sh
# Prometheusä¸€é”®å®‰è£…è„šæœ¬

PROMETHEUS_VERSION="2.45.0"
PROMETHEUS_USER="prometheus"
INSTALL_DIR="/opt/prometheus"
DATA_DIR="/var/lib/prometheus"
CONFIG_DIR="/etc/prometheus"

# åˆ›å»ºç”¨æˆ·å’Œç›®å½•
useradd --no-create-home --shell /bin/false $PROMETHEUS_USER
mkdir -p $INSTALL_DIR $DATA_DIR $CONFIG_DIR
chown -R $PROMETHEUS_USER:$PROMETHEUS_USER $INSTALL_DIR $DATA_DIR $CONFIG_DIR

# ä¸‹è½½å¹¶å®‰è£…Prometheus
cd /tmp
wget https://github.com/prometheus/prometheus/releases/download/v$PROMETHEUS_VERSION/prometheus-$PROMETHEUS_VERSION.linux-amd64.tar.gz
tar xzf prometheus-$PROMETHEUS_VERSION.linux-amd64.tar.gz
cd prometheus-$PROMETHEUS_VERSION.linux-amd64

# å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
cp prometheus promtool $INSTALL_DIR/
chown $PROMETHEUS_USER:$PROMETHEUS_USER $INSTALL_DIR/{prometheus,promtool}
chmod +x $INSTALL_DIR/{prometheus,promtool}

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp prometheus.yml $CONFIG_DIR/
chown -R $PROMETHEUS_USER:$PROMETHEUS_USER $CONFIG_DIR

# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
cat > /etc/systemd/system/prometheus.service << EOF
[Unit]
Description=Prometheus Monitoring System
Documentation=https://prometheus.io/docs/introduction/overview/
After=network.target

[Service]
User=$PROMETHEUS_USER
Group=$PROMETHEUS_USER
Type=simple
Restart=always
RestartSec=5
ExecStart=$INSTALL_DIR/prometheus \
    --config.file=$CONFIG_DIR/prometheus.yml \
    --storage.tsdb.path=$DATA_DIR \
    --storage.tsdb.retention.time=30d \
    --web.console.templates=$INSTALL_DIR/consoles \
    --web.console.libraries=$INSTALL_DIR/console_libraries \
    --web.listen-address=0.0.0.0:9090 \
    --web.external-url=http://prometheus.example.com \
    --web.enable-lifecycle \
    --web.enable-admin-api

ExecReload=/bin/kill -HUP \$MAINPID
LimitNOFILE=65536
TimeoutStopSec=20

[Install]
WantedBy=multi-user.target
EOF

# åˆ›å»ºé…ç½®ç›®å½•ç»“æ„
mkdir -p $CONFIG_DIR/{rules,rules.d,files_sd,targets}
cat > $CONFIG_DIR/prometheus.yml << 'EOF'
# å…¨å±€é…ç½®
global:
  scrape_interval: 15s      # é»˜è®¤æŠ“å–é—´éš”
  evaluation_interval: 15s  # è§„åˆ™è¯„ä¼°é—´éš”
  external_labels:          # å¤–éƒ¨æ ‡ç­¾
    region: 'north'
    env: 'production'

# å‘Šè­¦è§„åˆ™æ–‡ä»¶
rule_files:
  - "rules/*.yml"
  - "rules.d/*.yml"

# æŠ“å–é…ç½®
scrape_configs:
  # ç›‘æ§Prometheusè‡ªèº«
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    labels:
      service: 'monitoring'

  # ç›‘æ§æ‰€æœ‰Node Exporter
  - job_name: 'node'
    scrape_interval: 30s
    file_sd_configs:
      - files:
        - 'targets/node_*.yml'
        refresh_interval: 5m
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - source_labels: [__meta_dns_name]
        target_label: hostname

  # ç›‘æ§æ‰€æœ‰MySQL
  - job_name: 'mysql'
    scrape_interval: 30s
    static_configs:
      - targets: ['mysql-1:9104', 'mysql-2:9104']
    labels:
      database: 'mysql'

  # ç›‘æ§æ‰€æœ‰Nginx
  - job_name: 'nginx'
    scrape_interval: 30s
    static_configs:
      - targets: ['nginx-1:9113', 'nginx-2:9113']
    labels:
      service: 'web'

  # é€šè¿‡ConsulæœåŠ¡å‘ç°
  - job_name: 'consul-services'
    consul_sd_configs:
      - server: 'consul.example.com:8500'
        services: []
    relabel_configs:
      - source_labels: [__meta_consul_service]
        target_label: job
      - source_labels: [__meta_consul_tags]
        regex: ',(production|staging|dev),'
        target_label: env
        replacement: '$1'

# è¿œç¨‹è¯»å†™é…ç½®ï¼ˆå¯é€‰ï¼‰
remote_write:
  - url: "http://thanos-receive:19291/api/v1/receive"
    queue_config:
      max_samples_per_send: 1000
      capacity: 5000
      max_shards: 200

remote_read:
  - url: "http://thanos-query:10902/api/v1/read"
    read_recent: true
EOF

# åˆ›å»ºç¤ºä¾‹targetæ–‡ä»¶
cat > $CONFIG_DIR/targets/node_servers.yml << 'EOF'
- targets:
  - '192.168.1.100:9100'
  - '192.168.1.101:9100'
  - '192.168.1.102:9100'
  labels:
    datacenter: 'dc1'
    rack: 'rack-a'
EOF

# åˆ›å»ºå‘Šè­¦è§„åˆ™æ–‡ä»¶
cat > $CONFIG_DIR/rules/node_alerts.yml << 'EOF'
groups:
  - name: node_alerts
    interval: 30s
    rules:
      - alert: HighCpuUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
          team: infrastructure
        annotations:
          summary: "é«˜CPUä½¿ç”¨ç‡ (å®ä¾‹ {{ $labels.instance }})"
          description: "CPUä½¿ç”¨ç‡è¶…è¿‡80%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}%"
          runbook: "https://runbook.example.com/high-cpu"

      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
          team: infrastructure
        annotations:
          summary: "é«˜å†…å­˜ä½¿ç”¨ç‡ (å®ä¾‹ {{ $labels.instance }})"
          description: "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}%"

      - alert: DiskSpaceCritical
        expr: (node_filesystem_size_bytes{mountpoint="/"} - node_filesystem_free_bytes{mountpoint="/"}) / node_filesystem_size_bytes{mountpoint="/"} * 100 > 90
        for: 2m
        labels:
          severity: critical
          team: infrastructure
        annotations:
          summary: "ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³ (å®ä¾‹ {{ $labels.instance }})"
          description: "æ ¹åˆ†åŒºä½¿ç”¨ç‡è¶…è¿‡90%å·²ç»2åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}%"
          runbook: "https://runbook.example.com/disk-space"

      - alert: NodeDown
        expr: up{job="node"} == 0
        for: 1m
        labels:
          severity: critical
          team: infrastructure
        annotations:
          summary: "èŠ‚ç‚¹å®•æœº (å®ä¾‹ {{ $labels.instance }})"
          description: "èŠ‚ç‚¹ {{ $labels.instance }} å·²ç»å®•æœºè¶…è¿‡1åˆ†é’Ÿ"
EOF

# è®¾ç½®æƒé™
chown -R $PROMETHEUS_USER:$PROMETHEUS_USER $CONFIG_DIR
chmod -R 644 $CONFIG_DIR/*.yml
chmod 755 $CONFIG_DIR $CONFIG_DIR/{rules,rules.d,files_sd,targets}

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable prometheus
systemctl start prometheus

# æ£€æŸ¥çŠ¶æ€
sleep 3
systemctl status prometheus --no-pager

echo "Prometheuså®‰è£…å®Œæˆï¼"
echo "è®¿é—®åœ°å€: http://$(hostname -I | awk '{print $1}'):9090"
echo "æ•°æ®ç›®å½•: $DATA_DIR"
echo "é…ç½®ç›®å½•: $CONFIG_DIR"</code></pre>
            </div>

            <h3>2. Prometheusé…ç½®è¯¦è§£</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶é…ç½®</button>
                <pre><code># Prometheusé«˜çº§é…ç½®ç¤ºä¾‹

# 1. è¿œç¨‹å­˜å‚¨é…ç½®ï¼ˆVictoriaMetricsï¼‰
remote_write:
  - url: "http://victoria-metrics:8428/api/v1/write"
    write_relabel_configs:
      - action: keep
        regex: "node.*|prometheus.*"
        source_labels: [__name__]
    queue_config:
      max_shards: 10
      min_shards: 2
      max_samples_per_send: 500
      capacity: 10000
      batch_send_deadline: "5s"
      min_backoff: "100ms"
      max_backoff: "5s"

# 2. æœåŠ¡å‘ç°é…ç½®ï¼ˆKubernetesï¼‰
scrape_configs:
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      # åªæŠ“å–æœ‰æ³¨è§£ prometheus.io/scrape: "true" çš„pod
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      
      # ä»æ³¨è§£ä¸­è·å–æŠ“å–è·¯å¾„
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      
      # ä»æ³¨è§£ä¸­è·å–æŠ“å–ç«¯å£
      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        target_label: __address__
      
      # æ·»åŠ æ ‡å‡†æ ‡ç­¾
      - action: labelmap
        regex: __meta_kubernetes_pod_label_(.+)
      
      # è®¾ç½®å®ä¾‹åä¸º podå:ç«¯å£
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod
      
      # è®¾ç½®å‘½åç©ºé—´æ ‡ç­¾
      - source_labels: [__meta_kubernetes_namespace]
        target_label: namespace
      
      # è®¾ç½®èŠ‚ç‚¹æ ‡ç­¾
      - source_labels: [__meta_kubernetes_pod_node_name]
        target_label: node

# 3. é™æ€é…ç½®ç¤ºä¾‹
scrape_configs:
  - job_name: 'static-targets'
    static_configs:
      - targets:
        - 'app-1.example.com:8080'
        - 'app-2.example.com:8080'
        - 'app-3.example.com:8080'
        labels:
          environment: 'production'
          region: 'us-east-1'
          application: 'user-service'

# 4. æ–‡ä»¶æœåŠ¡å‘ç°
scrape_configs:
  - job_name: 'file-sd'
    file_sd_configs:
      - files:
        - '/etc/prometheus/targets/*.json'
        - '/etc/prometheus/targets/*.yml'
        refresh_interval: 5m
    relabel_configs:
      - source_labels: [__address__]
        regex: '(.*):(\d+)'
        replacement: '${1}'
        target_label: host
      - source_labels: [__address__]
        regex: '(.*):(\d+)'
        replacement: '${2}'
        target_label: port

# 5. æ ‡ç­¾é‡å†™è§„åˆ™
scrape_configs:
  - job_name: 'example'
    static_configs:
      - targets: ['example.com:80']
    metric_relabel_configs:
      # åˆ é™¤ä¸éœ€è¦çš„æŒ‡æ ‡
      - action: drop
        regex: 'go_.*'
        source_labels: [__name__]
      
      # é‡å‘½åæŒ‡æ ‡
      - source_labels: [__name__]
        regex: 'http_requests_(\w+)'
        replacement: 'http_${1}'
        target_label: __name__
      
      # æ·»åŠ æ ‡ç­¾
      - source_labels: [instance]
        regex: '([^:]+):\d+'
        replacement: '${1}'
        target_label: hostname
      
      # æ›¿æ¢æ ‡ç­¾å€¼
      - source_labels: [status_code]
        regex: '5..'
        replacement: 'server_error'
        target_label: status_group

# 6. å‘Šè­¦è§„åˆ™åˆ†ç»„
groups:
  - name: infrastructure_alerts
    interval: 30s
    rules:
      # ç³»ç»Ÿçº§åˆ«å‘Šè­¦
      - alert: InstanceDown
        expr: up == 0
        for: 5m
        labels:
          severity: critical
          domain: infrastructure
        annotations:
          summary: "å®ä¾‹ {{ $labels.instance }} å®•æœº"
          description: "{{ $labels.instance }} å·²ç»5åˆ†é’Ÿæ— æ³•è®¿é—®"
          runbook: "/runbooks/instance-down.md"
      
      # èµ„æºçº§åˆ«å‘Šè­¦
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 90
        for: 10m
        labels:
          severity: warning
          domain: infrastructure
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ {{ $labels.instance }}"
          description: "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%å·²ç»10åˆ†é’Ÿ"
          runbook: "/runbooks/high-memory.md"

  - name: application_alerts
    interval: 15s
    rules:
      # åº”ç”¨çº§åˆ«å‘Šè­¦
      - alert: HighRequestLatency
        expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, service)) > 0.5
        for: 2m
        labels:
          severity: warning
          domain: application
        annotations:
          summary: "é«˜è¯·æ±‚å»¶è¿Ÿ {{ $labels.service }}"
          description: "95%çš„è¯·æ±‚å»¶è¿Ÿè¶…è¿‡0.5ç§’"
          runbook: "/runbooks/high-latency.md"
      
      # ä¸šåŠ¡çº§åˆ«å‘Šè­¦
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
          domain: business
        annotations:
          summary: "é«˜é”™è¯¯ç‡ {{ $labels.service }}"
          description: "é”™è¯¯ç‡è¶…è¿‡5%å·²ç»5åˆ†é’Ÿ"
          runbook: "/runbooks/high-error-rate.md"</code></pre>
            </div>
        </section>

        <!-- å„ç§Exporteréƒ¨ç½² -->
        <section class="content-section" id="exporters">
            <h2>å››ã€å„ç§Exporteréƒ¨ç½²</h2>
            
            <div class="info-tip">
                <strong>ğŸ“Š Exporterç”Ÿæ€ç³»ç»Ÿï¼š</strong>
                <p>Prometheusæ‹¥æœ‰ä¸°å¯Œçš„Exporterç”Ÿæ€ç³»ç»Ÿï¼Œå¯ä»¥ç›‘æ§å‡ ä¹æ‰€æœ‰å¸¸è§çš„æœåŠ¡å’Œç³»ç»Ÿã€‚å®˜æ–¹å’Œç¤¾åŒºç»´æŠ¤äº†æ•°ç™¾ä¸ªExporterï¼Œè¦†ç›–äº†åŸºç¡€è®¾æ–½ã€ä¸­é—´ä»¶ã€æ•°æ®åº“ã€åº”ç”¨ç¨‹åºç­‰å„ä¸ªå±‚é¢ã€‚</p>
            </div>

            <h3>1. Node Exporterï¼ˆæœåŠ¡å™¨ç›‘æ§ï¼‰</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶è„šæœ¬</button>
                <pre><code>#!/bin/bash
# install_node_exporter.sh
# Node Exporterä¸€é”®å®‰è£…è„šæœ¬

NODE_EXPORTER_VERSION="1.6.0"
NODE_EXPORTER_USER="node_exporter"
INSTALL_DIR="/opt/node_exporter"

# åˆ›å»ºç”¨æˆ·
useradd --no-create-home --shell /bin/false $NODE_EXPORTER_USER

# ä¸‹è½½å¹¶å®‰è£…
cd /tmp
wget https://github.com/prometheus/node_exporter/releases/download/v$NODE_EXPORTER_VERSION/node_exporter-$NODE_EXPORTER_VERSION.linux-amd64.tar.gz
tar xzf node_exporter-$NODE_EXPORTER_VERSION.linux-amd64.tar.gz
cd node_exporter-$NODE_EXPORTER_VERSION.linux-amd64

# å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
cp node_exporter $INSTALL_DIR/
chown $NODE_EXPORTER_USER:$NODE_EXPORTER_USER $INSTALL_DIR/node_exporter
chmod +x $INSTALL_DIR/node_exporter

# åˆ›å»ºsystemdæœåŠ¡
cat > /etc/systemd/system/node_exporter.service << EOF
[Unit]
Description=Node Exporter
Documentation=https://github.com/prometheus/node_exporter
After=network.target

[Service]
User=$NODE_EXPORTER_USER
Group=$NODE_EXPORTER_USER
Type=simple
Restart=always
RestartSec=5
ExecStart=$INSTALL_DIR/node_exporter \
  --web.listen-address=":9100" \
  --collector.systemd \
  --collector.systemd.unit-whitelist="(docker|ssh|nginx|mysql).service" \
  --collector.processes \
  --collector.tcpstat \
  --collector.netdev \
  --collector.netstat \
  --collector.diskstats \
  --collector.filesystem \
  --collector.meminfo \
  --collector.loadavg \
  --collector.stat \
  --collector.vmstat \
  --collector.textfile.directory=/var/lib/node_exporter/textfile_collector \
  --log.level="info"

ExecReload=/bin/kill -HUP \$MAINPID
LimitNOFILE=65536
TimeoutStopSec=20

[Install]
WantedBy=multi-user.target
EOF

# åˆ›å»ºæ–‡æœ¬æ–‡ä»¶æ”¶é›†å™¨ç›®å½•
mkdir -p /var/lib/node_exporter/textfile_collector
chown -R $NODE_EXPORTER_USER:$NODE_EXPORTER_USER /var/lib/node_exporter

# åˆ›å»ºè‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†è„šæœ¬
cat > /usr/local/bin/custom_node_metrics.sh << 'EOF'
#!/bin/bash
# è‡ªå®šä¹‰èŠ‚ç‚¹æŒ‡æ ‡æ”¶é›†è„šæœ¬

OUTPUT_FILE="/var/lib/node_exporter/textfile_collector/custom_metrics.prom"

# 1. ç³»ç»Ÿæ›´æ–°æ—¶é—´
echo '# HELP node_system_uptime_seconds System uptime in seconds' > $OUTPUT_FILE
echo '# TYPE node_system_uptime_seconds gauge' >> $OUTPUT_FILE
echo "node_system_uptime_seconds $(awk '{print $1}' /proc/uptime)" >> $OUTPUT_FILE

# 2. ç™»å½•ç”¨æˆ·æ•°
LOGIN_USERS=$(who | wc -l)
echo '# HELP node_login_users Number of logged in users' >> $OUTPUT_FILE
echo '# TYPE node_login_users gauge' >> $OUTPUT_FILE
echo "node_login_users $LOGIN_USERS" >> $OUTPUT_FILE

# 3. åƒµå°¸è¿›ç¨‹æ•°
ZOMBIE_PROCESSES=$(ps aux | awk '{print $8}' | grep -c Z)
echo '# HELP node_zombie_processes Number of zombie processes' >> $OUTPUT_FILE
echo '# TYPE node_zombie_processes gauge' >> $OUTPUT_FILE
echo "node_zombie_processes $ZOMBIE_PROCESSES" >> $OUTPUT_FILE

# 4. æ–‡ä»¶å¥æŸ„ä½¿ç”¨ç‡
FILE_HANDLES=$(cat /proc/sys/fs/file-nr | awk '{print $1}')
FILE_HANDLES_MAX=$(cat /proc/sys/fs/file-max)
FILE_HANDLES_PERCENT=$(echo "scale=2; $FILE_HANDLES * 100 / $FILE_HANDLES_MAX" | bc)
echo '# HELP node_file_handles_used File handles used' >> $OUTPUT_FILE
echo '# TYPE node_file_handles_used gauge' >> $OUTPUT_FILE
echo "node_file_handles_used $FILE_HANDLES" >> $OUTPUT_FILE

echo '# HELP node_file_handles_max Maximum file handles' >> $OUTPUT_FILE
echo '# TYPE node_file_handles_max gauge' >> $OUTPUT_FILE
echo "node_file_handles_max $FILE_HANDLES_MAX" >> $OUTPUT_FILE

echo '# HELP node_file_handles_percent File handles usage percent' >> $OUTPUT_FILE
echo '# TYPE node_file_handles_percent gauge' >> $OUTPUT_FILE
echo "node_file_handles_percent $FILE_HANDLES_PERCENT" >> $OUTPUT_FILE

# 5. ç³»ç»Ÿè´Ÿè½½ï¼ˆ15åˆ†é’Ÿï¼‰
LOAD_15=$(awk '{print $3}' /proc/loadavg)
echo '# HELP node_load15 System load average for 15 minutes' >> $OUTPUT_FILE
echo '# TYPE node_load15 gauge' >> $OUTPUT_FILE
echo "node_load15 $LOAD_15" >> $OUTPUT_FILE

# 6. ç£ç›˜inodeä½¿ç”¨ç‡
DISK_INODES=$(df -i / | awk 'NR==2 {print $5}' | sed 's/%//')
echo '# HELP node_disk_inode_usage_percent Disk inode usage percent for root' >> $OUTPUT_FILE
echo '# TYPE node_disk_inode_usage_percent gauge' >> $OUTPUT_FILE
echo "node_disk_inode_usage_percent $DISK_INODES" >> $OUTPUT_FILE

# 7. ç½‘ç»œè¿æ¥ç»Ÿè®¡
TCP_ESTABLISHED=$(ss -s | awk '/^TCP:/ {print $4}')
echo '# HELP node_network_tcp_established Established TCP connections' >> $OUTPUT_FILE
echo '# TYPE node_network_tcp_established gauge' >> $OUTPUT_FILE
echo "node_network_tcp_established $TCP_ESTABLISHED" >> $OUTPUT_FILE

# 8. ç³»ç»Ÿæ—¶é—´åŒæ­¥çŠ¶æ€
NTP_SYNC=0
if chronyc tracking 2>/dev/null | grep -q "Leap status.*Normal"; then
    NTP_SYNC=1
elif ntpq -p 2>/dev/null | grep -q "^\*"; then
    NTP_SYNC=1
fi
echo '# HELP node_ntp_synchronized NTP synchronization status (1=synchronized, 0=not synchronized)' >> $OUTPUT_FILE
echo '# TYPE node_ntp_synchronized gauge' >> $OUTPUT_FILE
echo "node_ntp_synchronized $NTP_SYNC" >> $OUTPUT_FILE

# è®¾ç½®æƒé™
chown $NODE_EXPORTER_USER:$NODE_EXPORTER_USER $OUTPUT_FILE
chmod 644 $OUTPUT_FILE
EOF

chmod +x /usr/local/bin/custom_node_metrics.sh

# åˆ›å»ºå®šæ—¶ä»»åŠ¡
echo "*/30 * * * * root /usr/local/bin/custom_node_metrics.sh" > /etc/cron.d/node_exporter_custom_metrics

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable node_exporter
systemctl start node_exporter

# æ£€æŸ¥çŠ¶æ€
sleep 2
systemctl status node_exporter --no-pager

echo "Node Exporterå®‰è£…å®Œæˆï¼"
echo "è®¿é—®åœ°å€: http://$(hostname -I | awk '{print $1}'):9100"
echo "Metricsåœ°å€: http://$(hostname -I | awk '{print $1}'):9100/metrics"</code></pre>
            </div>

            <h3>2. MySQL Exporteré…ç½®</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶é…ç½®</button>
                <pre><code>#!/bin/bash
# install_mysql_exporter.sh
# MySQL Exporterå®‰è£…é…ç½®

MYSQL_EXPORTER_VERSION="0.15.0"
MYSQL_EXPORTER_USER="mysql_exporter"
INSTALL_DIR="/opt/mysql_exporter"

# åˆ›å»ºç”¨æˆ·
useradd --no-create-home --shell /bin/false $MYSQL_EXPORTER_USER

# ä¸‹è½½å¹¶å®‰è£…
cd /tmp
wget https://github.com/prometheus/mysqld_exporter/releases/download/v$MYSQL_EXPORTER_VERSION/mysqld_exporter-$MYSQL_EXPORTER_VERSION.linux-amd64.tar.gz
tar xzf mysqld_exporter-$MYSQL_EXPORTER_VERSION.linux-amd64.tar.gz
cd mysqld_exporter-$MYSQL_EXPORTER_VERSION.linux-amd64

# å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
cp mysqld_exporter $INSTALL_DIR/
chown $MYSQL_EXPORTER_USER:$MYSQL_EXPORTER_USER $INSTALL_DIR/mysqld_exporter
chmod +x $INSTALL_DIR/mysqld_exporter

# åœ¨MySQLä¸­åˆ›å»ºç›‘æ§ç”¨æˆ·
mysql -u root -p << 'EOF'
-- åˆ›å»ºç›‘æ§ç”¨æˆ·
CREATE USER 'exporter'@'localhost' IDENTIFIED BY 'ExporterPassword123!' WITH MAX_USER_CONNECTIONS 3;
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'localhost';
GRANT SELECT ON performance_schema.* TO 'exporter'@'localhost';

-- éªŒè¯æƒé™
SHOW GRANTS FOR 'exporter'@'localhost';
EOF

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/mysql_exporter.cnf << EOF
[client]
user=exporter
password=ExporterPassword123!
host=localhost
port=3306
EOF

chown $MYSQL_EXPORTER_USER:$MYSQL_EXPORTER_USER /etc/mysql_exporter.cnf
chmod 600 /etc/mysql_exporter.cnf

# åˆ›å»ºsystemdæœåŠ¡
cat > /etc/systemd/system/mysql_exporter.service << EOF
[Unit]
Description=MySQL Exporter
Documentation=https://github.com/prometheus/mysqld_exporter
After=network.target mysql.service

[Service]
User=$MYSQL_EXPORTER_USER
Group=$MYSQL_EXPORTER_USER
Type=simple
Restart=always
RestartSec=5
ExecStart=$INSTALL_DIR/mysqld_exporter \
  --web.listen-address=":9104" \
  --config.my-cnf=/etc/mysql_exporter.cnf \
  --collect.global_status \
  --collect.global_variables \
  --collect.info_schema.innodb_metrics \
  --collect.info_schema.processlist \
  --collect.info_schema.tables \
  --collect.info_schema.tablestats \
  --collect.info_schema.userstats \
  --collect.perf_schema.eventswaits \
  --collect.perf_schema.file_events \
  --collect.perf_schema.indexiowaits \
  --collect.perf_schema.tableiowaits \
  --collect.slave_status \
  --collect.auto_increment.columns \
  --collect.binlog_size \
  --collect.info_schema.query_response_time \
  --collect.engine_innodb_status \
  --log.level="info"

ExecReload=/bin/kill -HUP \$MAINPID
LimitNOFILE=65536
TimeoutStopSec=20

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable mysql_exporter
systemctl start mysql_exporter

# æ£€æŸ¥çŠ¶æ€
sleep 2
systemctl status mysql_exporter --no-pager

echo "MySQL Exporterå®‰è£…å®Œæˆï¼"
echo "è®¿é—®åœ°å€: http://$(hostname -I | awk '{print $1}'):9104"
echo "Metricsåœ°å€: http://$(hostname -I | awk '{print $1}'):9104/metrics"

# å…³é”®MySQLç›‘æ§æŒ‡æ ‡è¯´æ˜
cat << 'EOF'

=== å…³é”®MySQLç›‘æ§æŒ‡æ ‡ ===

1. è¿æ¥ç›¸å…³:
   mysql_global_status_threads_connected      # å½“å‰è¿æ¥æ•°
   mysql_global_status_max_used_connections   # å†å²æœ€å¤§è¿æ¥æ•°
   mysql_global_variables_max_connections     # æœ€å¤§è¿æ¥æ•°é™åˆ¶

2. æŸ¥è¯¢æ€§èƒ½:
   mysql_global_status_questions              # æ€»æŸ¥è¯¢æ•°
   mysql_global_status_slow_queries           # æ…¢æŸ¥è¯¢æ•°
   rate(mysql_global_status_questions[1m])    # QPS

3. InnoDBçŠ¶æ€:
   mysql_global_status_innodb_buffer_pool_pages_total     # ç¼“å†²æ± æ€»é¡µæ•°
   mysql_global_status_innodb_buffer_pool_pages_free      # ç¼“å†²æ± ç©ºé—²é¡µæ•°
   mysql_global_status_innodb_row_lock_time_avg           # å¹³å‡è¡Œé”ç­‰å¾…æ—¶é—´

4. å¤åˆ¶çŠ¶æ€:
   mysql_slave_status_slave_io_running        # IOçº¿ç¨‹çŠ¶æ€
   mysql_slave_status_slave_sql_running       # SQLçº¿ç¨‹çŠ¶æ€
   mysql_slave_status_seconds_behind_master   # å¤åˆ¶å»¶è¿Ÿç§’æ•°

5. è¡¨çŠ¶æ€:
   mysql_info_schema_table_size_bytes         # è¡¨å¤§å°
   mysql_info_schema_table_rows               # è¡¨è¡Œæ•°

=== å¸¸ç”¨å‘Šè­¦è§„åˆ™ ===

# è¿æ¥æ•°è¿‡é«˜
- alert: MySQLè¿æ¥æ•°è¿‡é«˜
  expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections > 0.8
  for: 5m

# æ…¢æŸ¥è¯¢è¿‡å¤š
- alert: MySQLæ…¢æŸ¥è¯¢è¿‡å¤š
  expr: rate(mysql_global_status_slow_queries[5m]) > 10
  for: 2m

# å¤åˆ¶å»¶è¿Ÿ
- alert: MySQLå¤åˆ¶å»¶è¿Ÿ
  expr: mysql_slave_status_seconds_behind_master > 30
  for: 5m

# InnoDBç¼“å†²æ± å‘½ä¸­ç‡ä½
- alert: InnoDBç¼“å†²æ± å‘½ä¸­ç‡ä½
  expr: (1 - (mysql_global_status_innodb_buffer_pool_reads / mysql_global_status_innodb_buffer_pool_read_requests)) * 100 < 90
  for: 10m
EOF</code></pre>
            </div>

            <h3>3. å…¶ä»–å¸¸ç”¨Exporter</h3>
            <div class="monitoring-cards">
                <div class="monitoring-card">
                    <h4><i class="fas fa-code"></i> Blackbox Exporter</h4>
                    <p>ç½‘ç»œæ¢æµ‹ï¼Œç›‘æ§HTTPã€HTTPSã€DNSã€TCPã€ICMPç­‰æœåŠ¡å¯ç”¨æ€§ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-database"></i> PostgreSQL Exporter</h4>
                    <p>PostgreSQLæ•°æ®åº“ç›‘æ§ï¼Œæ”¶é›†è¿æ¥æ•°ã€æŸ¥è¯¢æ€§èƒ½ã€é”ç­‰ä¿¡æ¯ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-cloud"></i> Cloud Exporter</h4>
                    <p>AWSã€Azureã€GCPäº‘æœåŠ¡ç›‘æ§ï¼Œæ”¶é›†äº‘èµ„æºä½¿ç”¨æƒ…å†µå’Œæˆæœ¬ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-bolt"></i> JMX Exporter</h4>
                    <p>Javaåº”ç”¨ç›‘æ§ï¼Œé€šè¿‡JMXæ”¶é›†JVMæ€§èƒ½æŒ‡æ ‡å’Œåº”ç”¨ä¸šåŠ¡æŒ‡æ ‡ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-exchange-alt"></i> HAProxy Exporter</h4>
                    <p>è´Ÿè½½å‡è¡¡å™¨ç›‘æ§ï¼Œæ”¶é›†è¿æ¥æ•°ã€è¯·æ±‚ç‡ã€åç«¯æœåŠ¡å™¨çŠ¶æ€ç­‰ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-cube"></i> cAdvisor</h4>
                    <p>å®¹å™¨ç›‘æ§ï¼Œæ”¶é›†Dockerå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ã€‚</p>
                </div>
            </div>
        </section>

        <!-- Grafanaå¯è§†åŒ–ä¸ä»ªè¡¨æ¿ -->
        <section class="content-section" id="grafana">
            <h2>äº”ã€Grafanaå¯è§†åŒ–ä¸ä»ªè¡¨æ¿</h2>
            
            <div class="success-tip">
                <strong>ğŸ“ˆ Grafanaä¼˜åŠ¿ï¼š</strong>
                <p>1. <strong>ä¸°å¯Œçš„å¯è§†åŒ–é€‰é¡¹</strong>ï¼šå›¾è¡¨ã€è¡¨æ ¼ã€ä»ªè¡¨ã€çƒ­å›¾ã€åœ°ç†åœ°å›¾ç­‰<br>
                2. <strong>å¼ºå¤§çš„æ•°æ®æºæ”¯æŒ</strong>ï¼šPrometheusã€MySQLã€PostgreSQLã€Elasticsearchç­‰<br>
                3. <strong>çµæ´»çš„å‘Šè­¦åŠŸèƒ½</strong>ï¼šå¯è§†åŒ–å‘Šè­¦é…ç½®ï¼Œå¤šç§é€šçŸ¥æ¸ é“<br>
                4. <strong>å›¢é˜Ÿåä½œ</strong>ï¼šæ–‡ä»¶å¤¹æƒé™ã€å…±äº«ä»ªè¡¨æ¿ã€ç‰ˆæœ¬ç®¡ç†</p>
            </div>

            <h3>1. Grafanaå®‰è£…ä¸é…ç½®</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶è„šæœ¬</button>
                <pre><code>#!/bin/bash
# install_grafana.sh
# Grafanaä¸€é”®å®‰è£…è„šæœ¬

GRAFANA_VERSION="10.0.3"
GRAFANA_USER="grafana"
INSTALL_DIR="/opt/grafana"
DATA_DIR="/var/lib/grafana"
CONFIG_DIR="/etc/grafana"
LOG_DIR="/var/log/grafana"

# ä¸‹è½½Grafana
cd /tmp
wget https://dl.grafana.com/oss/release/grafana-$GRAFANA_VERSION.linux-amd64.tar.gz
tar xzf grafana-$GRAFANA_VERSION.linux-amd64.tar.gz
mv grafana-$GRAFANA_VERSION $INSTALL_DIR

# åˆ›å»ºç”¨æˆ·å’Œç›®å½•
useradd --no-create-home --shell /bin/false $GRAFANA_USER
mkdir -p $DATA_DIR $CONFIG_DIR $LOG_DIR
chown -R $GRAFANA_USER:$GRAFANA_USER $INSTALL_DIR $DATA_DIR $CONFIG_DIR $LOG_DIR

# åˆ›å»ºsystemdæœåŠ¡
cat > /etc/systemd/system/grafana.service << EOF
[Unit]
Description=Grafana
Documentation=https://grafana.com/docs/
After=network.target

[Service]
User=$GRAFANA_USER
Group=$GRAFANA_USER
Type=simple
Restart=always
RestartSec=5
WorkingDirectory=$INSTALL_DIR
EnvironmentFile=-$CONFIG_DIR/grafana.conf
ExecStart=$INSTALL_DIR/bin/grafana-server \\
  --config=$CONFIG_DIR/grafana.ini \\
  --homepath=$INSTALL_DIR \\
  --packaging=docker \\
  cfg:default.paths.logs=$LOG_DIR \\
  cfg:default.paths.data=$DATA_DIR \\
  cfg:default.paths.plugins=$INSTALL_DIR/plugins \\
  cfg:default.paths.provisioning=$CONFIG_DIR/provisioning

ExecReload=/bin/kill -HUP \$MAINPID
LimitNOFILE=65536
TimeoutStopSec=20

[Install]
WantedBy=multi-user.target
EOF

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > $CONFIG_DIR/grafana.ini << 'EOF'
[server]
# ç›‘å¬åœ°å€å’Œç«¯å£
http_addr = 0.0.0.0
http_port = 3000
domain = grafana.example.com
root_url = %(protocol)s://%(domain)s:%(http_port)s/
serve_from_sub_path = false

# æ—¥å¿—é…ç½®
[log]
mode = console file
level = info
format = console

# æ•°æ®åº“é…ç½®ï¼ˆé»˜è®¤ä½¿ç”¨SQLiteï¼‰
[database]
type = sqlite3
path = grafana.db
max_idle_conn = 2
max_open_conn = 0
conn_max_lifetime = 14400

# å®‰å…¨é…ç½®
[security]
admin_user = admin
admin_password = admin
secret_key = SW2YcwTIb9zpOOhoPsMm
disable_gravatar = false
data_source_proxy_whitelist = 

# ç”¨æˆ·é…ç½®
[auth]
disable_login_form = false
disable_signout_menu = false

# åŒ¿åè®¿é—®é…ç½®
[auth.anonymous]
enabled = false
org_name = Main Org.
org_role = Viewer

# åŸºç¡€è®¤è¯é…ç½®
[auth.basic]
enabled = true

# é‚®ä»¶é…ç½®ï¼ˆå‘Šè­¦é€šçŸ¥ï¼‰
[smtp]
enabled = true
host = smtp.example.com:465
user = alert@example.com
password = YourPassword
from_address = alert@example.com
from_name = Grafana Alert

# ç”¨æˆ·é…ç½®
[users]
allow_sign_up = false
auto_assign_org = true
auto_assign_org_role = Viewer

# ä¼šè¯é…ç½®
[session]
provider = file
provider_config = sessions
cookie_secure = false
session_life_time = 86400

# åˆ†æé…ç½®
[analytics]
reporting_enabled = true
check_for_updates = true

# è·¯å¾„é…ç½®
[paths]
data = /var/lib/grafana
logs = /var/log/grafana
plugins = /opt/grafana/plugins
provisioning = /etc/grafana/provisioning

# å¿«ç…§é…ç½®
[snapshots]
external_enabled = true
external_snapshot_url = https://snapshots.example.com
external_snapshot_name = Grafana Snapshots

# æŒ‡æ ‡é…ç½®ï¼ˆGrafanaè‡ªèº«ç›‘æ§ï¼‰
[metrics]
enabled = true
interval_seconds = 10
EOF

# åˆ›å»ºæ•°æ®æºé…ç½®
mkdir -p $CONFIG_DIR/provisioning/datasources
cat > $CONFIG_DIR/provisioning/datasources/prometheus.yml << 'EOF'
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://localhost:9090
    isDefault: true
    editable: true
    jsonData:
      timeInterval: 15s
      queryTimeout: 60s
      httpMethod: POST
      manageAlerts: true
      prometheusType: Prometheus
      prometheusVersion: 2.45.0
      cacheLevel: 'High'
      exemplarTraceIdDestinations:
        - name: trace_id
          datasourceUid: tempo
    secureJsonData:
      tlsAuth: false
      tlsAuthWithCACert: false

  - name: Alertmanager
    type: alertmanager
    access: proxy
    url: http://localhost:9093
    editable: true
    jsonData:
      implementation: prometheus
      handleGrafanaManagedAlerts: true

  - name: Loki
    type: loki
    access: proxy
    url: http://localhost:3100
    editable: true
    jsonData:
      maxLines: 1000

  - name: Tempo
    type: tempo
    access: proxy
    url: http://localhost:3200
    editable: true
    jsonData:
      nodeGraph:
        enabled: true
      tracesToLogs:
        datasourceUid: 'loki'
        spanStartTimeShift: '-1h'
        spanEndTimeShift: '1h'
        tags: ['job', 'instance', 'pod', 'namespace']
        filterByTraceID: true
        filterBySpanID: true
EOF

# åˆ›å»ºä»ªè¡¨æ¿é…ç½®
mkdir -p $CONFIG_DIR/provisioning/dashboards
cat > $CONFIG_DIR/provisioning/dashboards/dashboards.yml << 'EOF'
apiVersion: 1

providers:
  - name: 'default'
    orgId: 1
    folder: ''
    type: file
    disableDeletion: false
    updateIntervalSeconds: 10
    allowUiUpdates: true
    options:
      path: /etc/grafana/dashboards
EOF

# åˆ›å»ºç¤ºä¾‹ä»ªè¡¨æ¿ç›®å½•
mkdir -p /etc/grafana/dashboards

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable grafana
systemctl start grafana

# æ£€æŸ¥çŠ¶æ€
sleep 5
systemctl status grafana --no-pager

echo "Grafanaå®‰è£…å®Œæˆï¼"
echo "è®¿é—®åœ°å€: http://$(hostname -I | awk '{print $1}'):3000"
echo "é»˜è®¤ç”¨æˆ·å: admin"
echo "é»˜è®¤å¯†ç : admin"
echo ""
echo "è¯·ç™»å½•åç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼"</code></pre>
            </div>

            <h3>2. Grafanaä»ªè¡¨æ¿è®¾è®¡</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">æŸ¥çœ‹JSON</button>
                <pre><code>{
  "dashboard": {
    "title": "Node Exporter Full",
    "tags": ["templated", "node-exporter"],
    "style": "dark",
    "timezone": "browser",
    "panels": [
      {
        "datasource": "Prometheus",
        "description": "æ€»ä½“CPUä½¿ç”¨ç‡",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percent"
          },
          "overrides": []
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 0
        },
        "id": 2,
        "options": {
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showThresholdLabels": false,
          "showThresholdMarkers": true
        },
        "pluginVersion": "9.3.2",
        "targets": [
          {
            "expr": "100 - (avg by(instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
            "interval": "",
            "legendFormat": "{{instance}}",
            "refId": "A"
          }
        ],
        "title": "CPU Usage",
        "type": "gauge"
      },
      {
        "datasource": "Prometheus",
        "description": "å†…å­˜ä½¿ç”¨æƒ…å†µ",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 10,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "normal"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "bytes"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Used"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "red",
                    "mode": "fixed"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Cached"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "yellow",
                    "mode": "fixed"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 0
        },
        "id": 3,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "expr": "node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes",
            "interval": "",
            "legendFormat": "Used",
            "refId": "A"
          },
          {
            "expr": "node_memory_Buffers_bytes",
            "hide": false,
            "interval": "",
            "legendFormat": "Buffers",
            "refId": "B"
          },
          {
            "expr": "node_memory_Cached_bytes",
            "hide": false,
            "interval": "",
            "legendFormat": "Cached",
            "refId": "C"
          }
        ],
        "title": "Memory Usage",
        "type": "timeseries"
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": [
        "5s",
        "10s",
        "30s",
        "1m",
        "5m",
        "15m",
        "30m",
        "1h",
        "2h",
        "1d"
      ],
      "time_options": [
        "5m",
        "15m",
        "1h",
        "6h",
        "12h",
        "24h",
        "2d",
        "7d",
        "30d"
      ]
    },
    "templating": {
      "list": [
        {
          "current": {
            "selected": false,
            "text": "All",
            "value": "$__all"
          },
          "datasource": "Prometheus",
          "definition": "label_values(node_cpu_seconds_total, instance)",
          "hide": 0,
          "includeAll": true,
          "multi": true,
          "name": "instance",
          "options": [],
          "query": {
            "query": "label_values(node_cpu_seconds_total, instance)",
            "refId": "StandardVariableQuery"
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 0,
          "type": "query"
        },
        {
          "current": {
            "selected": false,
            "text": "1m",
            "value": "1m"
          },
          "hide": 0,
          "includeAll": false,
          "label": "Interval",
          "multi": false,
          "name": "interval",
          "options": [
            {
              "selected": true,
              "text": "1m",
              "value": "1m"
            },
            {
              "selected": false,
              "text": "5m",
              "value": "5m"
            },
            {
              "selected": false,
              "text": "10m",
              "value": "10m"
            },
            {
              "selected": false,
              "text": "30m",
              "value": "30m"
            },
            {
              "selected": false,
              "text": "1h",
              "value": "1h"
            },
            {
              "selected": false,
              "text": "6h",
              "value": "6h"
            }
          ],
          "query": "1m,5m,10m,30m,1h,6h",
          "queryValue": "",
          "refresh": 2,
          "skipUrlSync": false,
          "type": "interval"
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "grafana",
            "uid": "-- Grafana --"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "target": {
            "limit": 100,
            "matchAny": false,
            "tags": [],
            "type": "dashboard"
          },
          "type": "dashboard"
        }
      ]
    },
    "refresh": "10s",
    "schemaVersion": 37,
    "version": 1,
    "uid": "node-exporter-full"
  },
  "folderUid": "general",
  "message": "Updated dashboard",
  "overwrite": true
}</code></pre>
            </div>
        </section>

        <!-- å‘Šè­¦è§„åˆ™ä¸é€šçŸ¥é…ç½® -->
        <section class="content-section" id="alerting">
            <h2>å…­ã€å‘Šè­¦è§„åˆ™ä¸é€šçŸ¥é…ç½®</h2>
            
            <div class="danger-tip">
                <strong>ğŸš¨ å‘Šè­¦è®¾è®¡åŸåˆ™ï¼š</strong>
                <p>1. <strong>åˆ†çº§åˆ†ç±»</strong>ï¼šæ ¹æ®ä¸¥é‡ç¨‹åº¦åˆ’åˆ†å‘Šè­¦çº§åˆ«ï¼ˆç´§æ€¥ã€é‡è¦ã€è­¦å‘Šï¼‰<br>
                2. <strong>é™é»˜é™å™ª</strong>ï¼šé¿å…å‘Šè­¦é£æš´ï¼Œåˆç†è®¾ç½®é™é»˜è§„åˆ™<br>
                3. <strong>æ˜ç¡®å¯æ“ä½œ</strong>ï¼šå‘Šè­¦ä¿¡æ¯åº”åŒ…å«å…·ä½“é—®é¢˜å’Œè§£å†³å»ºè®®<br>
                4. <strong>å¤šæ¸ é“é€šçŸ¥</strong>ï¼šé‡è¦å‘Šè­¦åº”é€šè¿‡å¤šç§æ¸ é“é€šçŸ¥<br>
                5. <strong>é—­ç¯ç®¡ç†</strong>ï¼šå‘Šè­¦åº”å…³è”äº‹ä»¶ã€å¤„ç†ã€å¤ç›˜å…¨è¿‡ç¨‹</p>
            </div>

            <h3>1. Alertmanageré…ç½®</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶é…ç½®</button>
                <pre><code># Alertmanageré…ç½® (alertmanager.yml)

global:
  # SMTPé…ç½®
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'YourPassword'
  smtp_require_tls: true
  
  # Slacké…ç½®
  slack_api_url: 'https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX'
  
  # å¾®ä¿¡ä¼ä¸šå·é…ç½®
  wechat_api_url: 'https://qyapi.weixin.qq.com/cgi-bin/'
  wechat_api_secret: 'your-wechat-secret'
  wechat_api_corp_id: 'your-corp-id'

# è·¯ç”±é…ç½® - å®šä¹‰å‘Šè­¦å¦‚ä½•è·¯ç”±åˆ°æ¥æ”¶å™¨
route:
  # é»˜è®¤è·¯ç”±
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  
  # å­è·¯ç”±
  routes:
    # æŒ‰ä¸¥é‡ç¨‹åº¦è·¯ç”±
    - match:
        severity: critical
      receiver: 'critical-receiver'
      group_wait: 5s
      group_interval: 5s
      repeat_interval: 5m
      continue: true
    
    # æŒ‰å›¢é˜Ÿè·¯ç”±
    - match_re:
        team: ^(infra|platform).*
      receiver: 'infra-team'
      continue: false
    
    - match_re:
        team: ^(dev|app).*
      receiver: 'dev-team'
      continue: false
    
    # æŒ‰æœåŠ¡è·¯ç”±
    - match:
        service: mysql
      receiver: 'dba-team'
      continue: false
    
    - match:
        service: nginx
      receiver: 'web-team'
      continue: false
    
    # å·¥ä½œæ—¶é—´è·¯ç”±
    - receiver: 'work-hours-receiver'
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h
      continue: true
      matchers:
        - name: time_range
          value: '09:00-18:00'
        - name: weekday
          value: '1-5'  # å‘¨ä¸€åˆ°å‘¨äº”

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™ - é¿å…é‡å¤å‘Šè­¦
inhibit_rules:
  # å½“æœ‰èŠ‚ç‚¹å®•æœºå‘Šè­¦æ—¶ï¼ŒæŠ‘åˆ¶è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: NodeDown
      severity: critical
    target_match:
      severity: critical
    equal: ['instance', 'cluster']
  
  # å½“æœ‰é›†ç¾¤çº§åˆ«æ•…éšœæ—¶ï¼ŒæŠ‘åˆ¶æ‰€æœ‰èŠ‚ç‚¹çº§åˆ«å‘Šè­¦
  - source_match:
      alertname: ClusterDown
    target_match_re:
      alertname: 'NodeDown|HighCpuUsage|HighMemoryUsage'
    equal: ['cluster']
  
  # ç½‘ç»œåˆ†åŒºå‘Šè­¦æŠ‘åˆ¶
  - source_match:
      alertname: NetworkPartition
    target_match:
      severity: warning
    equal: ['zone']

# é™é»˜é…ç½® - ä¸´æ—¶å…³é—­ç‰¹å®šå‘Šè­¦
# å¯ä»¥é€šè¿‡Web UIæˆ–APIé…ç½®

# æ¥æ”¶å™¨é…ç½® - å®šä¹‰å‘Šè­¦å‘é€æ–¹å¼
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'alerts@example.com'
        send_resolved: true
        headers:
          Subject: '[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}'
        html: |
          <h2>{{ .GroupLabels.alertname }}</h2>
          <p><strong>çŠ¶æ€</strong>: {{ .Status | toUpper }}</p>
          <p><strong>å¼€å§‹æ—¶é—´</strong>: {{ (index .Alerts 0).StartsAt }}</p>
          <p><strong>ç»“æŸæ—¶é—´</strong>: {{ (index .Alerts 0).EndsAt }}</p>
          <p><strong>æ‘˜è¦</strong>: {{ .CommonAnnotations.summary }}</p>
          <p><strong>æè¿°</strong>: {{ .CommonAnnotations.description }}</p>
          <hr>
          <h3>å‘Šè­¦è¯¦æƒ…</h3>
          <table border="1">
            <tr>
              <th>æ ‡ç­¾</th>
              <th>å€¼</th>
            </tr>
            {{ range .GroupLabels.SortedPairs }}
            <tr>
              <td>{{ .Name }}</td>
              <td>{{ .Value }}</td>
            </tr>
            {{ end }}
          </table>
          <hr>
          <p><strong>è¿è¡Œæ‰‹å†Œ</strong>: <a href="{{ .CommonAnnotations.runbook }}">{{ .CommonAnnotations.runbook }}</a></p>
    
    webhook_configs:
      - url: 'http://alert-webhook.example.com/alerts'
        send_resolved: true
  
  # ç´§æ€¥å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-receiver'
    email_configs:
      - to: 'oncall@example.com, manager@example.com'
        send_resolved: true
    
    # Slacké€šçŸ¥
    slack_configs:
      - channel: '#alerts-critical'
        title: '[CRITICAL] {{ .GroupLabels.alertname }}'
        text: |-
          {{ range .Alerts }}
          *Alert:* {{ .Annotations.summary }}
          *Description:* {{ .Annotations.description }}
          *Labels:*
          {{ range .Labels.SortedPairs }} â€¢ {{ .Name }}: {{ .Value }}
          {{ end }}
          {{ end }}
        send_resolved: true
        color: 'danger'  # çº¢è‰²
    
    # å¾®ä¿¡é€šçŸ¥
    wechat_configs:
      - agent_id: '1000002'
        to_user: '@all'
        to_party: '2'
        message: '{{ template "wechat.default.message" . }}'
        send_resolved: true
    
    # ç”µè¯å‘Šè­¦ï¼ˆé€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰
    webhook_configs:
      - url: 'http://phone-alert-service.example.com/call'
        send_resolved: false
  
  # åŸºç¡€è®¾æ–½å›¢é˜Ÿ
  - name: 'infra-team'
    email_configs:
      - to: 'infra-team@example.com'
    slack_configs:
      - channel: '#infra-alerts'
  
  # å¼€å‘å›¢é˜Ÿ
  - name: 'dev-team'
    email_configs:
      - to: 'dev-team@example.com'
    slack_configs:
      - channel: '#dev-alerts'
  
  # DBAå›¢é˜Ÿ
  - name: 'dba-team'
    email_configs:
      - to: 'dba-team@example.com'
    webhook_configs:
      - url: 'http://dba-alert.example.com/webhook'
  
  # å·¥ä½œæ—¶é—´æ¥æ”¶å™¨
  - name: 'work-hours-receiver'
    email_configs:
      - to: 'work-hours-team@example.com'
    slack_configs:
      - channel: '#work-hours-alerts'

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# é’‰é’‰æœºå™¨äººé…ç½®æ¨¡æ¿
- name: 'dingtalk-receiver'
  dingtalk_configs:
    - url: 'https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxx'
      message: |
        {{ range .Alerts }}
        ## [{{ .Status | toUpper }}] {{ .Labels.alertname }}
        **å¼€å§‹æ—¶é—´**: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
        **å®ä¾‹**: {{ .Labels.instance }}
        **æ‘˜è¦**: {{ .Annotations.summary }}
        **æè¿°**: {{ .Annotations.description }}
        {{ if .Annotations.runbook }}
        **è¿è¡Œæ‰‹å†Œ**: [æŸ¥çœ‹]({{ .Annotations.runbook }})
        {{ end }}
        ---
        {{ end }}
      send_resolved: true

# ä¼ä¸šå¾®ä¿¡é…ç½®æ¨¡æ¿
- name: 'wechat-work-receiver'
  wechat_configs:
    - api_secret: 'your-secret'
      corp_id: 'your-corp-id'
      agent_id: '1000002'
      message: '{{ template "wechat.default.message" . }}'
      send_resolved: true

# çŸ­ä¿¡é…ç½®ï¼ˆé€šè¿‡é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰
- name: 'sms-receiver'
  webhook_configs:
    - url: 'http://sms-gateway.example.com/send'
      send_resolved: false</code></pre>
            </div>

            <h3>2. å‘Šè­¦è§„åˆ™æœ€ä½³å®è·µ</h3>
            <div class="alert-levels">
                <span class="alert-level alert-critical">ç´§æ€¥ (Critical)</span>
                <span class="alert-level alert-warning">é‡è¦ (Warning)</span>
                <span class="alert-level alert-info">è­¦å‘Š (Info)</span>
            </div>

            <table class="monitoring-table">
                <thead>
                    <tr>
                        <th>å‘Šè­¦çº§åˆ«</th>
                        <th>å“åº”æ—¶é—´</th>
                        <th>é€šçŸ¥æ¸ é“</th>
                        <th>ç¤ºä¾‹åœºæ™¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ç´§æ€¥</strong></td>
                        <td>5åˆ†é’Ÿå†…</td>
                        <td>ç”µè¯+çŸ­ä¿¡+é’‰é’‰+é‚®ä»¶</td>
                        <td>æ ¸å¿ƒæœåŠ¡ä¸å¯ç”¨ã€æ•°æ®åº“å®•æœºã€é‡å¤§å®‰å…¨äº‹ä»¶</td>
                    </tr>
                    <tr>
                        <td><strong>é‡è¦</strong></td>
                        <td>30åˆ†é’Ÿå†…</td>
                        <td>é’‰é’‰+é‚®ä»¶+Slack</td>
                        <td>æ€§èƒ½ä¸¥é‡ä¸‹é™ã€ç£ç›˜ç©ºé—´ä¸è¶³ã€CPUä½¿ç”¨ç‡è¿‡é«˜</td>
                    </tr>
                    <tr>
                        <td><strong>è­¦å‘Š</strong></td>
                        <td>2å°æ—¶å†…</td>
                        <td>é‚®ä»¶+ä¼ä¸šå¾®ä¿¡</td>
                        <td>ç£ç›˜ä½¿ç”¨ç‡é¢„è­¦ã€å†…å­˜ä½¿ç”¨ç‡é¢„è­¦ã€æœåŠ¡é‡å¯</td>
                    </tr>
                </tbody>
            </table>

            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶è§„åˆ™</button>
                <pre><code># ä¼ä¸šçº§å‘Šè­¦è§„åˆ™ç¤ºä¾‹

groups:
  # ============ åŸºç¡€è®¾æ–½å‘Šè­¦ ============
  - name: infrastructure_alerts
    interval: 30s
    rules:
      # èŠ‚ç‚¹å®•æœº
      - alert: NodeDown
        expr: up{job="node"} == 0
        for: 1m
        labels:
          severity: critical
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "èŠ‚ç‚¹å®•æœº {{ $labels.instance }}"
          description: "èŠ‚ç‚¹ {{ $labels.instance }} å·²ç»å®•æœºè¶…è¿‡1åˆ†é’Ÿ"
          runbook: "https://runbook.example.com/node-down"
          dashboard: "https://grafana.example.com/d/node-overview"
      
      # CPUä½¿ç”¨ç‡è¿‡é«˜
      - alert: HighCpuUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "é«˜CPUä½¿ç”¨ç‡ {{ $labels.instance }}"
          description: "CPUä½¿ç”¨ç‡è¶…è¿‡80%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/high-cpu"
          dashboard: "https://grafana.example.com/d/node-cpu"
      
      # å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 10m
        labels:
          severity: warning
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "é«˜å†…å­˜ä½¿ç”¨ç‡ {{ $labels.instance }}"
          description: "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%å·²ç»10åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/high-memory"
          dashboard: "https://grafana.example.com/d/node-memory"
      
      # ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³
      - alert: DiskSpaceCritical
        expr: (node_filesystem_size_bytes{mountpoint="/"} - node_filesystem_free_bytes{mountpoint="/"}) / node_filesystem_size_bytes{mountpoint="/"} * 100 > 90
        for: 2m
        labels:
          severity: critical
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³ {{ $labels.instance }}"
          description: "æ ¹åˆ†åŒºä½¿ç”¨ç‡è¶…è¿‡90%å·²ç»2åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/disk-space"
          dashboard: "https://grafana.example.com/d/node-disk"
      
      # ç£ç›˜ç©ºé—´é¢„è­¦
      - alert: DiskSpaceWarning
        expr: (node_filesystem_size_bytes{mountpoint="/"} - node_filesystem_free_bytes{mountpoint="/"}) / node_filesystem_size_bytes{mountpoint="/"} * 100 > 80
        for: 10m
        labels:
          severity: warning
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "ç£ç›˜ç©ºé—´é¢„è­¦ {{ $labels.instance }}"
          description: "æ ¹åˆ†åŒºä½¿ç”¨ç‡è¶…è¿‡80%å·²ç»10åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/disk-space"
          dashboard: "https://grafana.example.com/d/node-disk"
      
      # ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
      - alert: HighSystemLoad
        expr: node_load1 > count by(instance) (node_cpu_seconds_total{mode="system"}) * 1.5
        for: 5m
        labels:
          severity: warning
          team: infrastructure
          domain: infrastructure
          service: node
        annotations:
          summary: "é«˜ç³»ç»Ÿè´Ÿè½½ {{ $labels.instance }}"
          description: "1åˆ†é’Ÿç³»ç»Ÿè´Ÿè½½è¶…è¿‡CPUæ ¸å¿ƒæ•°1.5å€å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}"
          runbook: "https://runbook.example.com/high-load"
          dashboard: "https://grafana.example.com/d/node-load"

  # ============ åº”ç”¨æœåŠ¡å‘Šè­¦ ============
  - name: application_alerts
    interval: 15s
    rules:
      # æœåŠ¡å®•æœº
      - alert: ServiceDown
        expr: up{job=~".*"} == 0
        for: 1m
        labels:
          severity: critical
          team: development
          domain: application
        annotations:
          summary: "æœåŠ¡å®•æœº {{ $labels.job }}"
          description: "æœåŠ¡ {{ $labels.job }} (å®ä¾‹ {{ $labels.instance }}) å·²ç»å®•æœºè¶…è¿‡1åˆ†é’Ÿ"
          runbook: "https://runbook.example.com/service-down"
          dashboard: "https://grafana.example.com/d/service-overview"
      
      # é«˜è¯·æ±‚å»¶è¿Ÿ
      - alert: HighRequestLatency
        expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, job, instance)) > 1
        for: 2m
        labels:
          severity: warning
          team: development
          domain: application
        annotations:
          summary: "é«˜è¯·æ±‚å»¶è¿Ÿ {{ $labels.job }}"
          description: "95%çš„è¯·æ±‚å»¶è¿Ÿè¶…è¿‡1ç§’å·²ç»2åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}ç§’"
          runbook: "https://runbook.example.com/high-latency"
          dashboard: "https://grafana.example.com/d/service-latency"
      
      # é«˜é”™è¯¯ç‡
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
          team: development
          domain: application
        annotations:
          summary: "é«˜é”™è¯¯ç‡ {{ $labels.job }}"
          description: "HTTP 5xxé”™è¯¯ç‡è¶…è¿‡5%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/high-error-rate"
          dashboard: "https://grafana.example.com/d/service-errors"
      
      # ä½è¯·æ±‚é‡ï¼ˆå¯èƒ½æœåŠ¡æœ‰é—®é¢˜ä½†æ²¡æŠ¥é”™ï¼‰
      - alert: LowRequestRate
        expr: rate(http_requests_total[10m]) < 10
        for: 5m
        labels:
          severity: warning
          team: development
          domain: application
        annotations:
          summary: "ä½è¯·æ±‚é‡ {{ $labels.job }}"
          description: "è¯·æ±‚ç‡ä½äº10æ¬¡/ç§’å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}æ¬¡/ç§’"
          runbook: "https://runbook.example.com/low-request-rate"
          dashboard: "https://grafana.example.com/d/service-traffic"

  # ============ æ•°æ®åº“å‘Šè­¦ ============
  - name: database_alerts
    interval: 30s
    rules:
      # MySQLè¿æ¥æ•°è¿‡é«˜
      - alert: MySQLHighConnections
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections * 100 > 80
        for: 5m
        labels:
          severity: warning
          team: dba
          domain: database
          service: mysql
        annotations:
          summary: "MySQLè¿æ¥æ•°è¿‡é«˜ {{ $labels.instance }}"
          description: "MySQLè¿æ¥æ•°è¶…è¿‡æœ€å¤§è¿æ¥æ•°çš„80%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/mysql-connections"
          dashboard: "https://grafana.example.com/d/mysql-overview"
      
      # MySQLå¤åˆ¶å»¶è¿Ÿ
      - alert: MySQLReplicationLag
        expr: mysql_slave_status_seconds_behind_master > 30
        for: 5m
        labels:
          severity: critical
          team: dba
          domain: database
          service: mysql
        annotations:
          summary: "MySQLå¤åˆ¶å»¶è¿Ÿ {{ $labels.instance }}"
          description: "MySQLä»åº“å¤åˆ¶å»¶è¿Ÿè¶…è¿‡30ç§’å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value }}ç§’"
          runbook: "https://runbook.example.com/mysql-replication"
          dashboard: "https://grafana.example.com/d/mysql-replication"
      
      # InnoDBç¼“å†²æ± å‘½ä¸­ç‡ä½
      - alert: MySQLInnoDBBufferPoolHitRateLow
        expr: (1 - (mysql_global_status_innodb_buffer_pool_reads / mysql_global_status_innodb_buffer_pool_read_requests)) * 100 < 90
        for: 10m
        labels:
          severity: warning
          team: dba
          domain: database
          service: mysql
        annotations:
          summary: "InnoDBç¼“å†²æ± å‘½ä¸­ç‡ä½ {{ $labels.instance }}"
          description: "InnoDBç¼“å†²æ± å‘½ä¸­ç‡ä½äº90%å·²ç»10åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/mysql-innodb"
          dashboard: "https://grafana.example.com/d/mysql-innodb"

  # ============ ä¸šåŠ¡æŒ‡æ ‡å‘Šè­¦ ============
  - name: business_alerts
    interval: 1m
    rules:
      # è®¢å•é‡å¼‚å¸¸ä¸‹é™
      - alert: OrderRateAbnormalDrop
        expr: rate(orders_total[10m]) < rate(orders_total[40m:10m]) * 0.5
        for: 5m
        labels:
          severity: critical
          team: business
          domain: business
        annotations:
          summary: "è®¢å•é‡å¼‚å¸¸ä¸‹é™"
          description: "æœ€è¿‘10åˆ†é’Ÿè®¢å•é‡æ¯”40åˆ†é’Ÿå‰ä¸‹é™è¶…è¿‡50%ã€‚å½“å‰é€Ÿç‡: {{ $value }} è®¢å•/åˆ†é’Ÿ"
          runbook: "https://runbook.example.com/order-drop"
          dashboard: "https://grafana.example.com/d/business-orders"
      
      # æ”¯ä»˜å¤±è´¥ç‡è¿‡é«˜
      - alert: HighPaymentFailureRate
        expr: rate(payment_attempts_total{status="failed"}[10m]) / rate(payment_attempts_total[10m]) * 100 > 10
        for: 5m
        labels:
          severity: critical
          team: business
          domain: business
        annotations:
          summary: "æ”¯ä»˜å¤±è´¥ç‡è¿‡é«˜"
          description: "æ”¯ä»˜å¤±è´¥ç‡è¶…è¿‡10%å·²ç»5åˆ†é’Ÿã€‚å½“å‰å€¼: {{ $value | humanizePercentage }}"
          runbook: "https://runbook.example.com/payment-failure"
          dashboard: "https://grafana.example.com/d/business-payments"
      
      # ç”¨æˆ·æ´»è·ƒåº¦ä¸‹é™
      - alert: UserActivityDrop
        expr: active_users_total < (active_users_total offset 1d) * 0.7
        for: 1h
        labels:
          severity: warning
          team: business
          domain: business
        annotations:
          summary: "ç”¨æˆ·æ´»è·ƒåº¦ä¸‹é™"
          description: "å½“å‰æ´»è·ƒç”¨æˆ·æ•°æ¯”æ˜¨å¤©åŒæ—¶æ®µä¸‹é™è¶…è¿‡30%ã€‚å½“å‰å€¼: {{ $value }}"
          runbook: "https://runbook.example.com/user-activity"
          dashboard: "https://grafana.example.com/d/business-users"

  # ============ é»‘ç›’ç›‘æ§å‘Šè­¦ ============
  - name: blackbox_alerts
    interval: 30s
    rules:
      # HTTPæ¢æµ‹å¤±è´¥
      - alert: HTTPProbeFailed
        expr: probe_success{job="blackbox-http"} == 0
        for: 1m
        labels:
          severity: critical
          team: infrastructure
          domain: availability
        annotations:
          summary: "HTTPæœåŠ¡ä¸å¯ç”¨ {{ $labels.instance }}"
          description: "HTTPæœåŠ¡ {{ $labels.instance }} æ¢æµ‹å¤±è´¥å·²ç»1åˆ†é’Ÿ"
          runbook: "https://runbook.example.com/http-probe-failed"
          dashboard: "https://grafana.example.com/d/blackbox-http"
      
      # SSLè¯ä¹¦å³å°†è¿‡æœŸ
      - alert: SSLCertExpiringSoon
        expr: probe_ssl_earliest_cert_expiry{job="blackbox-https"} - time() < 86400 * 30  # 30å¤©å†…è¿‡æœŸ
        for: 0m
        labels:
          severity: warning
          team: infrastructure
          domain: security
        annotations:
          summary: "SSLè¯ä¹¦å³å°†è¿‡æœŸ {{ $labels.instance }}"
          description: "SSLè¯ä¹¦å°†åœ¨{{ $value | humanizeDuration }}åè¿‡æœŸ"
          runbook: "https://runbook.example.com/ssl-cert-expiring"
          dashboard: "https://grafana.example.com/d/blackbox-ssl"</code></pre>
            </div>
        </section>

        <!-- é«˜å¯ç”¨ä¸ç”Ÿäº§ä¼˜åŒ– -->
        <section class="content-section" id="high-availability">
            <h2>ä¸ƒã€é«˜å¯ç”¨ä¸ç”Ÿäº§ä¼˜åŒ–</h2>
            
            <div class="info-tip">
                <strong>ğŸ—ï¸ ç”Ÿäº§ç¯å¢ƒè¦æ±‚ï¼š</strong>
                <p>1. <strong>é«˜å¯ç”¨æ€§</strong>ï¼šç›‘æ§ç³»ç»Ÿè‡ªèº«ä¸èƒ½æˆä¸ºå•ç‚¹æ•…éšœ<br>
                2. <strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒç›‘æ§ä¸ŠåƒèŠ‚ç‚¹ï¼ŒPBçº§æ•°æ®å­˜å‚¨<br>
                3. <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæŸ¥è¯¢å“åº”æ—¶é—´åœ¨ç§’çº§ï¼Œèµ„æºæ¶ˆè€—å¯æ§<br>
                4. <strong>å®‰å…¨æ€§</strong>ï¼šè®¿é—®æ§åˆ¶ã€æ•°æ®åŠ å¯†ã€å®¡è®¡æ—¥å¿—<br>
                5. <strong>å¯ç»´æŠ¤æ€§</strong>ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ã€é…ç½®ç®¡ç†ã€æ•…éšœè‡ªæ„ˆ</p>
            </div>

            <h3>1. Prometheusé«˜å¯ç”¨æ–¹æ¡ˆ</h3>
            
            <div class="architecture-diagram">
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #4f46e5; color: white;">
                        <i class="fas fa-globe"></i> è´Ÿè½½å‡è¡¡å™¨
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #7c3aed; color: white; width: 90%;">
                        <div style="display: flex; justify-content: space-around;">
                            <span>Prometheus A</span>
                            <span>Prometheus B</span>
                        </div>
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #8b5cf6; color: white;">
                        Thanos Query
                    </div>
                    <div class="layer-arrow">â†“</div>
                </div>
                <div class="architecture-layer">
                    <div class="layer-box" style="background: #a78bfa; color: white;">
                        <div style="display: flex; justify-content: space-around;">
                            <span>å¯¹è±¡å­˜å‚¨</span>
                            <span>é•¿æœŸå­˜å‚¨</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶é…ç½®</button>
                <pre><code># Prometheusé«˜å¯ç”¨é…ç½®ç¤ºä¾‹

# 1. å¤šå‰¯æœ¬Prometheusé…ç½®
# prometheus-a.yml å’Œ prometheus-b.yml é…ç½®ç›¸åŒï¼Œä½†external_labelsä¸åŒ

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'production'
    replica: 'A'  # å‰¯æœ¬Aä½¿ç”¨'A'ï¼Œå‰¯æœ¬Bä½¿ç”¨'B'

# 2. æœåŠ¡å‘ç°é…ç½®ï¼ˆç¡®ä¿ä¸¤ä¸ªå‰¯æœ¬æŠ“å–ç›¸åŒçš„targetsï¼‰
scrape_configs:
  - job_name: 'node'
    consul_sd_configs:
      - server: 'consul.example.com:8500'
        services: ['node-exporter']
    relabel_configs:
      - source_labels: [__meta_consul_service]
        target_label: job
      - source_labels: [__meta_consul_tags]
        regex: ',(production|staging|dev),'
        target_label: env

# 3. Thanos Sidecaré…ç½®ï¼ˆä¸æ¯ä¸ªPrometheuså®ä¾‹ä¸€èµ·è¿è¡Œï¼‰
# thanos-sidecar.yml
prometheus:
  external_url: "http://prometheus-a.example.com:9090"
  # æˆ– "http://prometheus-b.example.com:9090"

thanos:
  sidecar:
    grpc_address: "0.0.0.0:10901"
    http_address: "0.0.0.0:10902"
    prometheus_url: "http://localhost:9090"
    tsdb_path: "/var/lib/prometheus"
  
  objstore:
    type: S3
    config:
      bucket: "thanos-metrics"
      endpoint: "s3.example.com"
      access_key: "YOUR_ACCESS_KEY"
      secret_key: "YOUR_SECRET_KEY"
      insecure: false
      signature_version2: false
      put_user_metadata: {}
      http_config:
        idle_conn_timeout: 90s
        response_header_timeout: 2m
      trace:
        enable: true
  
  compactor:
    data_dir: "/var/lib/thanos/compactor"
    retention: 30d
  
  query:
    http_address: "0.0.0.0:10903"
    grpc_address: "0.0.0.0:10904"
    store:
      - "prometheus-a.example.com:10901"
      - "prometheus-b.example.com:10901"
      - "thanos-store.example.com:10901"

# 4. Thanos Queryå‰ç«¯é…ç½®
# thanos-query.yml
http:
  address: "0.0.0.0:10905"
  grace_period: 2m

grpc:
  address: "0.0.0.0:10906"

query:
  replica_labels:
    - "replica"
    - "prometheus_replica"
  
  auto_downsampling: true
  partial_response: true
  default_evaluation_interval: 1m

stores:
  - "prometheus-a.example.com:10901"
  - "prometheus-b.example.com:10901"
  - "thanos-store.example.com:10901"

# 5. è´Ÿè½½å‡è¡¡é…ç½®ï¼ˆNginxï¼‰
# nginx.conf
upstream prometheus {
    zone prometheus 64k;
    server prometheus-a.example.com:9090 max_fails=3 fail_timeout=30s;
    server prometheus-b.example.com:9090 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

upstream thanos_query {
    zone thanos_query 64k;
    server thanos-query.example.com:10905 max_fails=3 fail_timeout=30s;
    keepalive 16;
}

server {
    listen 80;
    server_name prometheus.example.com;
    
    location / {
        proxy_pass http://prometheus;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å¥åº·æ£€æŸ¥
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
        proxy_connect_timeout 2s;
        proxy_read_timeout 30s;
        proxy_send_timeout 30s;
    }
}

server {
    listen 80;
    server_name thanos.example.com;
    
    location / {
        proxy_pass http://thanos_query;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# 6. ç›‘æ§ç›®æ ‡åˆ†ç‰‡é…ç½®ï¼ˆå½“ç›‘æ§ç›®æ ‡å¤ªå¤šæ—¶ï¼‰
# æ ¹æ®æ ‡ç­¾å°†ç›®æ ‡åˆ†ç‰‡åˆ°ä¸åŒçš„Prometheuså®ä¾‹

scrape_configs:
  - job_name: 'node-shard-0'
    consul_sd_configs:
      - server: 'consul.example.com:8500'
        services: ['node-exporter']
    relabel_configs:
      # æ ¹æ®å®ä¾‹åç§°å“ˆå¸Œåˆ†ç‰‡
      - source_labels: [__meta_consul_service_id]
        action: hashmod
        modulus: 2
        target_label: __tmp_hash
      - source_labels: [__tmp_hash]
        action: keep
        regex: ^0$  # è¿™ä¸ªå®ä¾‹åªæŠ“å–hashä¸º0çš„ç›®æ ‡
  
  - job_name: 'node-shard-1'
    consul_sd_configs:
      - server: 'consul.example.com:8500'
        services: ['node-exporter']
    relabel_configs:
      - source_labels: [__meta_consul_service_id]
        action: hashmod
        modulus: 2
        target_label: __tmp_hash
      - source_labels: [__tmp_hash]
        action: keep
        regex: ^1$  # è¿™ä¸ªå®ä¾‹åªæŠ“å–hashä¸º1çš„ç›®æ ‡

# 7. è¿œç¨‹å†™é…ç½®ï¼ˆå°†æ•°æ®å†™å…¥VictoriaMetricsé›†ç¾¤ï¼‰
remote_write:
  - url: "http://vminsert:8480/insert/0/prometheus/api/v1/write"
    queue_config:
      max_samples_per_send: 10000
      capacity: 100000
      max_shards: 30
    write_relabel_configs:
      # åªä¿ç•™é‡è¦çš„æŒ‡æ ‡
      - action: keep
        regex: "up|node_.*|process_.*|prometheus_.*"
        source_labels: [__name__]

# 8. èµ„æºé™åˆ¶é…ç½®
# é€šè¿‡cgroupsæˆ–systemdé™åˆ¶èµ„æºä½¿ç”¨

[Service]
MemoryLimit=8G
CPUQuota=200%
IOWeight=100
TasksMax=10000

# 9. æ•°æ®ä¿ç•™ç­–ç•¥
# prometheus.yml
storage:
  tsdb:
    retention: 15d  # æœ¬åœ°ä¿ç•™15å¤©
    out_of_order_time_window: 1h

# è¿œç¨‹å­˜å‚¨ä¿ç•™æ›´é•¿æ—¶é—´
remote_write:
  - url: "http://long-term-storage:9090/api/v1/write"
    remote_timeout: 30s
    write_relabel_configs:
      - action: keep
        regex: ".*"
        source_labels: [__name__]

# 10. å¤‡ä»½ç­–ç•¥
# backup_prometheus.sh
#!/bin/bash
BACKUP_DIR="/backup/prometheus"
DATE=$(date +%Y%m%d_%H%M%S)

# åœæ­¢PrometheusæŠ“å–
curl -X POST http://localhost:9090/-/quit

# ç­‰å¾…å†™å…¥å®Œæˆ
sleep 30

# å¤‡ä»½æ•°æ®ç›®å½•
tar czf $BACKUP_DIR/prometheus_data_$DATE.tar.gz /var/lib/prometheus/

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar czf $BACKUP_DIR/prometheus_config_$DATE.tar.gz /etc/prometheus/

# é‡å¯Prometheus
systemctl restart prometheus

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/prometheus_data_$DATE.tar.gz"</code></pre>
            </div>

            <h3>2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-date">å­˜å‚¨ä¼˜åŒ–</div>
                    <p>ä½¿ç”¨SSDå­˜å‚¨TSDBæ•°æ®ï¼Œå¯ç”¨å‹ç¼©ï¼Œå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ã€‚</p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">æŸ¥è¯¢ä¼˜åŒ–</div>
                    <p>ä½¿ç”¨Recording Rulesé¢„è®¡ç®—å¸¸ç”¨æŸ¥è¯¢ï¼Œä¼˜åŒ–PromQLï¼Œé¿å…é«˜åŸºæ•°æŸ¥è¯¢ã€‚</p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">ç½‘ç»œä¼˜åŒ–</div>
                    <p>é…ç½®åˆç†çš„æŠ“å–é—´éš”ï¼Œä½¿ç”¨è¿æ¥æ± ï¼Œå¯ç”¨HTTP/2ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”ã€‚</p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">å†…å­˜ä¼˜åŒ–</div>
                    <p>è°ƒæ•´å—å¤§å°ï¼Œç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œå¯ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œé¿å…OOMã€‚</p>
                </div>
            </div>
        </section>

        <!-- æ€»ç»“ä¸æœ€ä½³å®è·µ -->
        <section class="content-section" id="summary">
            <h2>å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
            
            <div class="success-tip">
                <strong>âœ… ç›‘æ§ä½“ç³»å»ºè®¾æˆåŠŸæ ‡å¿—ï¼š</strong>
                <p>1. <strong>å…¨é¢è¦†ç›–</strong>ï¼šåŸºç¡€è®¾æ–½ã€åº”ç”¨ã€ä¸šåŠ¡å…¨é¢ç›‘æ§<br>
                2. <strong>åŠæ—¶å‘Šè­¦</strong>ï¼šé—®é¢˜å‘ç°æ—¶é—´ä»å°æ—¶çº§é™ä½åˆ°åˆ†é’Ÿçº§<br>
                3. <strong>å¿«é€Ÿå®šä½</strong>ï¼šMTTRï¼ˆå¹³å‡ä¿®å¤æ—¶é—´ï¼‰æ˜¾è‘—é™ä½<br>
                4. <strong>æ•°æ®é©±åŠ¨</strong>ï¼šç›‘æ§æ•°æ®ç”¨äºå®¹é‡è§„åˆ’å’Œæ€§èƒ½ä¼˜åŒ–<br>
                5. <strong>å›¢é˜Ÿèµ‹èƒ½</strong>ï¼šå¼€å‘ã€è¿ç»´ã€ä¸šåŠ¡å›¢é˜Ÿéƒ½èƒ½ä½¿ç”¨ç›‘æ§æ•°æ®</p>
            </div>

            <h3>1. å®æ–½è·¯çº¿å›¾</h3>
            <table class="monitoring-table">
                <thead>
                    <tr>
                        <th>é˜¶æ®µ</th>
                        <th>æ—¶é—´</th>
                        <th>ä¸»è¦ä»»åŠ¡</th>
                        <th>å…³é”®æˆæœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ç¬¬ä¸€é˜¶æ®µ</strong></td>
                        <td>1-2å‘¨</td>
                        <td>åŸºç¡€è®¾æ–½ç›‘æ§ã€åŸºç¡€å‘Šè­¦</td>
                        <td>æœåŠ¡å™¨ç›‘æ§ã€åŸºç¡€å‘Šè­¦è§„åˆ™</td>
                    </tr>
                    <tr>
                        <td><strong>ç¬¬äºŒé˜¶æ®µ</strong></td>
                        <td>2-4å‘¨</td>
                        <td>åº”ç”¨ç›‘æ§ã€ä¸šåŠ¡ç›‘æ§</td>
                        <td>åº”ç”¨æ€§èƒ½ç›‘æ§ã€å…³é”®ä¸šåŠ¡æŒ‡æ ‡</td>
                    </tr>
                    <tr>
                        <td><strong>ç¬¬ä¸‰é˜¶æ®µ</strong></td>
                        <td>4-8å‘¨</td>
                        <td>é«˜å¯ç”¨ã€è‡ªåŠ¨åŒ–ã€ä¼˜åŒ–</td>
                        <td>ç›‘æ§ç³»ç»Ÿé«˜å¯ç”¨ã€è‡ªåŠ¨åŒ–éƒ¨ç½²</td>
                    </tr>
                    <tr>
                        <td><strong>ç¬¬å››é˜¶æ®µ</strong></td>
                        <td>æŒç»­ä¼˜åŒ–</td>
                        <td>æ™ºèƒ½åˆ†æã€é¢„æµ‹å‘Šè­¦</td>
                        <td>å¼‚å¸¸æ£€æµ‹ã€å®¹é‡é¢„æµ‹ã€AIOps</td>
                    </tr>
                </tbody>
            </table>

            <h3>2. ç›‘æ§ç³»ç»Ÿæ£€æŸ¥æ¸…å•</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶æ¸…å•</button>
                <pre><code># ä¼ä¸šçº§ç›‘æ§ç³»ç»Ÿæ£€æŸ¥æ¸…å•

"""
1. æ•°æ®é‡‡é›†æ£€æŸ¥
    â–¡ æ‰€æœ‰æœåŠ¡å™¨éƒ¨ç½²Node Exporter
    â–¡ å…³é”®æœåŠ¡æœ‰ä¸“ç”¨Exporterï¼ˆMySQLã€Nginxç­‰ï¼‰
    â–¡ åº”ç”¨å±‚ä¸šåŠ¡æŒ‡æ ‡é‡‡é›†
    â–¡ ç½‘ç»œæ¢æµ‹ï¼ˆé»‘ç›’ç›‘æ§ï¼‰é…ç½®
    â–¡ æ—¥å¿—æŒ‡æ ‡é‡‡é›†ï¼ˆé€šè¿‡Lokiæˆ–ELKï¼‰

2. å­˜å‚¨ä¸å¤„ç†æ£€æŸ¥
    â–¡ Prometheusé…ç½®é«˜å¯ç”¨
    â–¡ æ•°æ®ä¿ç•™ç­–ç•¥åˆç†ï¼ˆæœ¬åœ°+è¿œç¨‹ï¼‰
    â–¡ å‘Šè­¦è§„åˆ™åˆ†ç±»æ¸…æ™°
    â–¡ è®°å½•è§„åˆ™ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
    â–¡ è¿œç¨‹å†™é…ç½®æ­£ç¡®

3. å¯è§†åŒ–æ£€æŸ¥
    â–¡ Grafanaä»ªè¡¨æ¿è¦†ç›–æ‰€æœ‰ç›‘æ§ç»´åº¦
    â–¡ ä»ªè¡¨æ¿æœ‰æ¸…æ™°çš„åˆ†ç±»å’Œç»„ç»‡
    â–¡ å…³é”®æŒ‡æ ‡æœ‰å®æ—¶å¯è§†åŒ–
    â–¡ å†å²æ•°æ®å¯å›æº¯åˆ†æ
    â–¡ æƒé™æ§åˆ¶é…ç½®æ­£ç¡®

4. å‘Šè­¦é€šçŸ¥æ£€æŸ¥
    â–¡ å‘Šè­¦åˆ†çº§åˆç†ï¼ˆç´§æ€¥/é‡è¦/è­¦å‘Šï¼‰
    â–¡ é€šçŸ¥æ¸ é“è¦†ç›–å…¨é¢ï¼ˆé‚®ä»¶/é’‰é’‰/çŸ­ä¿¡ï¼‰
    â–¡ å‘Šè­¦æŠ‘åˆ¶è§„åˆ™é…ç½®åˆç†
    â–¡ é™é»˜è§„åˆ™ç®¡ç†è§„èŒƒ
    â–¡ å‘Šè­¦å¤„ç†æµç¨‹æ˜ç¡®

5. é«˜å¯ç”¨æ£€æŸ¥
    â–¡ Prometheuså¤šå‰¯æœ¬éƒ¨ç½²
    â–¡ Alertmanageré›†ç¾¤éƒ¨ç½²
    â–¡ Grafanaé…ç½®æŒä¹…åŒ–å­˜å‚¨
    â–¡ è´Ÿè½½å‡è¡¡é…ç½®æ­£ç¡®
    â–¡ å¤‡ä»½æ¢å¤æ–¹æ¡ˆéªŒè¯

6. æ€§èƒ½æ£€æŸ¥
    â–¡ æŸ¥è¯¢å“åº”æ—¶é—´åœ¨ç§’çº§
    â–¡ æŠ“å–é—´éš”åˆç†ï¼ˆä¸é€ æˆç›®æ ‡å‹åŠ›ï¼‰
    â–¡ å†…å­˜ä½¿ç”¨å¯æ§ï¼ˆæ— OOMé£é™©ï¼‰
    â–¡ ç£ç›˜ç©ºé—´å……è¶³ï¼ˆæœ‰é¢„è­¦æœºåˆ¶ï¼‰
    â–¡ ç½‘ç»œå¸¦å®½è¶³å¤Ÿ

7. å®‰å…¨æ£€æŸ¥
    â–¡ ç›‘æ§ç³»ç»Ÿè®¿é—®æ§åˆ¶
    â–¡ æ•°æ®ä¼ è¾“åŠ å¯†ï¼ˆHTTPSï¼‰
    â–¡ è®¤è¯æˆæƒé…ç½®
    â–¡ å®¡è®¡æ—¥å¿—å¼€å¯
    â–¡ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

8. è¿ç»´æ£€æŸ¥
    â–¡ é…ç½®ç‰ˆæœ¬ç®¡ç†
    â–¡ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
    â–¡ ç›‘æ§ç³»ç»Ÿè‡ªèº«ç›‘æ§
    â–¡ å®¹é‡è§„åˆ’é¢„æµ‹
    â–¡ å®šæœŸæ¼”ç»ƒæ¢å¤

9. æ–‡æ¡£æ£€æŸ¥
    â–¡ æ¶æ„è®¾è®¡æ–‡æ¡£å®Œæ•´
    â–¡ éƒ¨ç½²è¿ç»´æ‰‹å†Œ
    â–¡ å‘Šè­¦å¤„ç†æ‰‹å†Œï¼ˆRunbookï¼‰
    â–¡ æ•…éšœæ’æŸ¥æŒ‡å—
    â–¡ åŸ¹è®­ææ–™

10. åˆè§„æ£€æŸ¥
    â–¡ æ•°æ®ä¿ç•™ç¬¦åˆæ³•è§„è¦æ±‚
    â–¡ å®¡è®¡æ—¥å¿—æ»¡è¶³åˆè§„
    â–¡ è®¿é—®æ§åˆ¶ç¬¦åˆå®‰å…¨æ”¿ç­–
    â–¡ å‘Šè­¦é€šçŸ¥ç¬¦åˆSLA
    â–¡ æ•…éšœå¤„ç†æµç¨‹è§„èŒƒ
"""

# ç›‘æ§ç³»ç»Ÿæˆç†Ÿåº¦è¯„ä¼°
MATURITY_LEVELS = {
    "Level 1 - åŸºç¡€ç›‘æ§": "æœåŠ¡å™¨åŸºç¡€æŒ‡æ ‡ç›‘æ§ï¼Œæ‰‹åŠ¨å‘Šè­¦",
    "Level 2 - æ ‡å‡†ç›‘æ§": "åº”ç”¨å’Œä¸šåŠ¡ç›‘æ§ï¼Œè‡ªåŠ¨åŒ–å‘Šè­¦",
    "Level 3 - é«˜çº§ç›‘æ§": "å…¨é“¾è·¯ç›‘æ§ï¼Œé¢„æµ‹æ€§å‘Šè­¦",
    "Level 4 - æ™ºèƒ½ç›‘æ§": "AIOpsï¼Œè‡ªåŠ¨åŒ–ä¿®å¤ï¼Œä¸šåŠ¡å½±å“åˆ†æ"
}</code></pre>
            </div>

            <h3>3. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
            <div class="warning-tip">
                <strong>â“ é—®é¢˜ï¼šPrometheuså†…å­˜å ç”¨è¿‡é«˜</strong>
                <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>
                1. è°ƒæ•´å—å¤§å°å’Œä¿ç•™æ—¶é—´<br>
                2. ä½¿ç”¨Recording Rulesé¢„è®¡ç®—<br>
                3. é™åˆ¶æ ‡ç­¾åŸºæ•°ï¼ˆé¿å…é«˜åŸºæ•°æ ‡ç­¾ï¼‰<br>
                4. å¯ç”¨æ•°æ®åˆ†ç‰‡å’Œè¿œç¨‹å­˜å‚¨</p>
            </div>

            <div class="danger-tip">
                <strong>â“ é—®é¢˜ï¼šå‘Šè­¦é£æš´</strong>
                <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>
                1. åˆç†é…ç½®å‘Šè­¦æŠ‘åˆ¶è§„åˆ™<br>
                2. è®¾ç½®åˆç†çš„å‘Šè­¦é—´éš”å’Œç­‰å¾…æ—¶é—´<br>
                3. ä½¿ç”¨å‘Šè­¦åˆ†ç»„ï¼ˆæŒ‰æœåŠ¡ã€æŒ‰å®ä¾‹ï¼‰<br>
                4. å®ç°å‘Šè­¦å‡çº§å’Œé™çº§æœºåˆ¶</p>
            </div>

            <div class="info-tip">
                <strong>â“ é—®é¢˜ï¼šç›‘æ§æ•°æ®ä¸ä¸€è‡´</strong>
                <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>
                1. ç»Ÿä¸€æ—¶é’ŸåŒæ­¥ï¼ˆNTPï¼‰<br>
                2. é…ç½®åˆç†çš„æŠ“å–è¶…æ—¶æ—¶é—´<br>
                3. ç›‘æ§Exporterå¥åº·çŠ¶å†µ<br>
                4. å®ç°æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥</p>
            </div>

            <h3>4. æœªæ¥å‘å±•è¶‹åŠ¿</h3>
            <div class="monitoring-cards">
                <div class="monitoring-card">
                    <h4><i class="fas fa-robot"></i> AIOpsæ™ºèƒ½è¿ç»´</h4>
                    <p>æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹ã€æ ¹å› åˆ†æã€è‡ªåŠ¨åŒ–ä¿®å¤ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-link"></i> å¯è§‚æµ‹æ€§</h4>
                    <p>Metricsã€Logsã€Tracesä¸‰ä½ä¸€ä½“ï¼Œå…¨é“¾è·¯è¿½è¸ªã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-cloud"></i> äº‘åŸç”Ÿç›‘æ§</h4>
                    <p>KubernetesåŸç”Ÿç›‘æ§ï¼ŒService Meshç›‘æ§ï¼ŒServerlessç›‘æ§ã€‚</p>
                </div>
                <div class="monitoring-card">
                    <h4><i class="fas fa-chart-network"></i> ä¸šåŠ¡å¯è§‚æµ‹æ€§</h4>
                    <p>ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ï¼Œç”¨æˆ·ä½“éªŒç›‘æ§ï¼Œä¸šåŠ¡å½±å“åˆ†æã€‚</p>
                </div>
            </div>

            <div class="success-tip" style="margin-top: 30px;">
                <strong>ğŸ¯ æœ€åå»ºè®®ï¼š</strong>
                <p>1. <strong>ä»å°å¤„ç€æ‰‹</strong>ï¼šä»æ ¸å¿ƒä¸šåŠ¡å¼€å§‹ï¼Œé€æ­¥æ‰©å¤§ç›‘æ§èŒƒå›´<br>
                2. <strong>æŒç»­è¿­ä»£</strong>ï¼šç›‘æ§ç³»ç»Ÿéœ€è¦æŒç»­ä¼˜åŒ–å’Œæ¼”è¿›<br>
                3. <strong>æ–‡åŒ–å…ˆè¡Œ</strong>ï¼šå»ºç«‹æ•°æ®é©±åŠ¨çš„è¿ç»´æ–‡åŒ–<br>
                4. <strong>å·¥å…·ä¸ºè¾…</strong>ï¼šå·¥å…·æ˜¯æ‰‹æ®µï¼Œè§£å†³é—®é¢˜æ‰æ˜¯ç›®çš„<br>
                5. <strong>å…¨å‘˜å‚ä¸</strong>ï¼šç›‘æ§ä¸ä»…æ˜¯è¿ç»´çš„äº‹ï¼Œéœ€è¦å¼€å‘ã€æµ‹è¯•ã€ä¸šåŠ¡å…±åŒå‚ä¸</p>
            </div>
        </section>

        <!-- æ–‡ç« ç»“æŸè¯­ -->
        <div style="text-align: center; margin: 50px 0 30px; padding: 30px; border-radius: 12px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));">
            <h3 style="color: #6366f1; margin-bottom: 15px;">ğŸ“Š ç›‘æ§æ˜¯è¿ç»´çš„çœ¼ç›ï¼Œå‘Šè­¦æ˜¯è¿ç»´çš„è€³æœµï¼</h3>
            <p style="margin-bottom: 20px;">ä¸€ä¸ªå®Œå–„çš„ä¼ä¸šçº§ç›‘æ§å‘Šè­¦ç³»ç»Ÿæ˜¯ä¿éšœä¸šåŠ¡ç¨³å®šè¿è¡Œçš„åŸºçŸ³ã€‚é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ„å»ºä¸€å¥—ä»æ•°æ®é‡‡é›†ã€å­˜å‚¨å¤„ç†ã€å¯è§†åŒ–å±•ç¤ºåˆ°å‘Šè­¦é€šçŸ¥çš„å®Œæ•´ç›‘æ§ä½“ç³»ã€‚è®°ä½ï¼Œç›‘æ§çš„æœ€ç»ˆç›®æ ‡ä¸æ˜¯æ”¶é›†æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡æ•°æ®å‘ç°é—®é¢˜ã€è§£å†³é—®é¢˜ã€é¢„é˜²é—®é¢˜ã€‚</p>
            <p style="font-size: 14px; color: #94a3b8;">å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï¼</p>
        </div>

        <!-- æ–‡ç« ä¿¡æ¯ -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #334155;">
            <div>
                <span style="font-size: 14px; color: #94a3b8;">æ ‡ç­¾ï¼š</span>
                <span style="background: #1e293b; color: #cbd5e1; padding: 4px 12px; border-radius: 20px; font-size: 13px; margin-right: 8px;">ç›‘æ§ç³»ç»Ÿ</span>
                <span style="background: #1e293b; color: #cbd5e1; padding: 4px 12px; border-radius: 20px; font-size: 13px; margin-right: 8px;">Prometheus</span>
                <span style="background: #1e293b; color: #cbd5e1; padding: 4px 12px; border-radius: 20px; font-size: 13px; margin-right: 8px;">Grafana</span>
                <span style="background: #1e293b; color: #cbd5e1; padding: 4px 12px; border-radius: 20px; font-size: 13px;">è¿ç»´å®æˆ˜</span>
            </div>
            <div style="font-size: 14px; color: #94a3b8;">
                <span>æœ€åæ›´æ–°ï¼š2025-12-08</span>
            </div>
        </div>
    </main>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <div class="back-to-top" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const body = document.body;
            if (body.classList.contains('light')) {
                body.classList.remove('light');
                body.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.remove('dark');
                body.classList.add('light');
                localStorage.setItem('theme', 'light');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.classList.remove('light', 'dark');
            document.body.classList.add(savedTheme);
            
            // åˆå§‹åŒ–ä»£ç å¤åˆ¶åŠŸèƒ½
            initCopyButtons();
        });

        // å¤åˆ¶ä»£ç åŠŸèƒ½
        function copyCode(button) {
            const codeBlock = button.nextElementSibling;
            const codeText = codeBlock.textContent;
            
            navigator.clipboard.writeText(codeText).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                button.classList.add('copied');
                button.textContent = 'å·²å¤åˆ¶ï¼';
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.textContent = button.textContent.includes('SQL') ? 'å¤åˆ¶SQL' : 
                                      button.textContent.includes('è„šæœ¬') ? 'å¤åˆ¶è„šæœ¬' : 
                                      button.textContent.includes('é…ç½®') ? 'å¤åˆ¶é…ç½®' : 
                                      button.textContent.includes('æ¸…å•') ? 'å¤åˆ¶æ¸…å•' : 'å¤åˆ¶ä»£ç ';
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                button.textContent = 'å¤åˆ¶å¤±è´¥';
                setTimeout(() => {
                    button.textContent = 'å¤åˆ¶ä»£ç ';
                }, 2000);
            });
        }

        // åˆå§‹åŒ–æ‰€æœ‰å¤åˆ¶æŒ‰é’®
        function initCopyButtons() {
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => copyCode(button));
            });
        }

        // å›åˆ°é¡¶éƒ¨åŠŸèƒ½
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
        window.addEventListener('scroll', () => {
            const backToTopBtn = document.querySelector('.back-to-top');
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        // ç›®å½•ç‚¹å‡»å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('.toc a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                    const offset = 100; // å¯¼èˆªæ é«˜åº¦åç§»
                    const targetPosition = targetElement.offsetTop - offset;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                    
                    // æ›´æ–°URLå“ˆå¸Œï¼ˆå¯é€‰ï¼‰
                    history.pushState(null, null, `#${targetId}`);
                }
            });
        });

        // ç›‘å¬æ»šåŠ¨ï¼Œé«˜äº®å½“å‰æŸ¥çœ‹çš„ç« èŠ‚
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.content-section');
            const navLinks = document.querySelectorAll('.toc a');
            
            let currentSection = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 150;
                const sectionHeight = section.clientHeight;
                
                if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSection}`) {
                    link.classList.add('active');
                }
            });
        });

        // ä»£ç å—è¯­æ³•é«˜äº®ï¼ˆç®€å•å®ç°ï¼‰
        function highlightCode() {
            const codeBlocks = document.querySelectorAll('pre code');
            codeBlocks.forEach(block => {
                // ç®€å•çš„å…³é”®å­—é«˜äº®
                const code = block.textContent;
                const highlighted = code
                    .replace(/\b(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP|GRANT|REVOKE|FROM|WHERE|AND|OR|JOIN|INTO|VALUES|SET|TABLE|DATABASE|INDEX|VIEW|PROCEDURE|FUNCTION|TRIGGER|EVENT)\b/gi, '<span class="keyword">$1</span>')
                    .replace(/\b(NULL|TRUE|FALSE|NOT)\b/gi, '<span class="constant">$1</span>')
                    .replace(/("[^"]*"|'[^']*')/g, '<span class="string">$1</span>')
                    .replace(/(--.*$|\/\*[\s\S]*?\*\/)/gm, '<span class="comment">$1</span>');
                
                block.innerHTML = highlighted;
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œä»£ç é«˜äº®
        window.addEventListener('load', highlightCode);
    </script>
</body>
</html>
