<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨Pythonè‡ªåŠ¨åŒ–æ‰¹é‡éƒ¨ç½²æœåŠ¡å™¨ - ä½•å“¥çš„åšå®¢</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans SC", sans-serif;
            line-height: 1.7;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light {
            background-color: #f8fafc;
            color: #1f2937;
        }

        body.dark {
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        body.light .navbar {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .navbar {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            align-items: center;
            list-style: none;
        }

        .nav-menu a {
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 8px 16px;
            border-radius: 8px;
        }

        body.light .nav-menu a {
            color: #4b5563;
        }

        body.dark .nav-menu a {
            color: #cbd5e1;
        }

        body.light .nav-menu a:hover {
            color: #3b82f6;
            background: #f3f4f6;
        }

        body.dark .nav-menu a:hover {
            color: #60a5fa;
            background: #1e293b;
        }

        .theme-toggle {
            width: 50px;
            height: 26px;
            border-radius: 13px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        body.light .theme-toggle {
            background: #e5e7eb;
        }

        body.dark .theme-toggle {
            background: #3b82f6;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            background: white;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        body.dark .theme-toggle::before {
            transform: translateX(24px);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            max-width: 900px;
            margin: 100px auto 60px;
            padding: 0 20px;
        }

        /* è¿”å›æŒ‰é’® */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* æ–‡ç« å¤´éƒ¨ */
        .article-header {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid;
        }

        body.light .article-header {
            border-color: #e5e7eb;
        }

        body.dark .article-header {
            border-color: #334155;
        }

        .article-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        body.light .article-title {
            color: #1f2937;
        }

        body.dark .article-title {
            color: #f1f5f9;
        }

        .article-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
        }

        body.light .article-meta {
            color: #6b7280;
        }

        body.dark .article-meta {
            color: #94a3b8;
        }

        .article-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 13px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
        }

        .article-intro {
            font-size: 16px;
            line-height: 1.8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 40px;
        }

        body.light .article-intro {
            background: #f8fafc;
            color: #475569;
        }

        body.dark .article-intro {
            background: #1e293b;
            color: #cbd5e1;
        }

        /* ç›®å½• */
        .toc {
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 40px;
            border-left: 4px solid #f97316;
        }

        body.light .toc {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .toc {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .toc h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        body.light .toc h4 {
            color: #1f2937;
        }

        body.dark .toc h4 {
            color: #f1f5f9;
        }

        .toc ul {
            list-style: none;
            display: grid;
            gap: 10px;
        }

        .toc li a {
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s;
            display: block;
        }

        body.light .toc li a {
            color: #4b5563;
        }

        body.dark .toc li a {
            color: #cbd5e1;
        }

        body.light .toc li a:hover {
            color: #f97316;
            background: #f3f4f6;
            transform: translateX(4px);
        }

        body.dark .toc li a:hover {
            color: #fb923c;
            background: #0f172a;
            transform: translateX(4px);
        }

        /* å†…å®¹åŒºå— */
        .content-section {
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s;
        }

        body.light .content-section {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark .content-section {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .content-section:hover {
            transform: translateY(-2px);
        }

        body.light .content-section:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        body.dark .content-section:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid;
        }

        body.light h2 {
            color: #f97316;
            border-color: rgba(249, 115, 22, 0.2);
        }

        body.dark h2 {
            color: #fb923c;
            border-color: rgba(251, 146, 60, 0.2);
        }

        h3 {
            font-size: 20px;
            font-weight: 600;
            margin: 24px 0 16px;
        }

        body.light h3 {
            color: #1f2937;
        }

        body.dark h3 {
            color: #f1f5f9;
        }

        p {
            margin-bottom: 16px;
            font-size: 15px;
            line-height: 1.8;
        }

        ul {
            margin: 16px 0 16px 24px;
            line-height: 1.8;
        }

        li {
            margin-bottom: 10px;
            font-size: 15px;
        }

        strong {
            font-weight: 600;
        }

        body.light strong {
            color: #1f2937;
        }

        body.dark strong {
            color: #f1f5f9;
        }

        /* ä»£ç å— */
        .code-container {
            position: relative;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        pre {
            padding: 24px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid #f97316;
        }

        body.light pre {
            background: #f1f5f9;
        }

        body.dark pre {
            background: #0f172a;
        }

        code {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        body.light code {
            color: #dc2626;
            background: #f1f5f9;
        }

        body.dark code {
            color: #f87171;
            background: #1e293b;
        }

        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 8px 16px;
            background: #f97316;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #ea580c;
        }

        .copy-btn.copied {
            background: #3b82f6;
        }

        /* è­¦å‘Šæç¤º */
        .warning-tip {
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        body.light .warning-tip {
            background: rgba(245, 158, 11, 0.1);
        }

        body.dark .warning-tip {
            background: rgba(245, 158, 11, 0.15);
        }

        .warning-tip strong {
            color: #f59e0b;
            display: block;
            margin-bottom: 8px;
        }

        /* å±é™©æç¤º */
        .danger-tip {
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
        }

        body.light .danger-tip {
            background: rgba(239, 68, 68, 0.1);
        }

        body.dark .danger-tip {
            background: rgba(239, 68, 68, 0.15);
        }

        .danger-tip strong {
            color: #ef4444;
            display: block;
            margin-bottom: 8px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .deploy-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .deploy-table th, .deploy-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid;
        }

        body.light .deploy-table th {
            background: #f1f5f9;
            color: #1f2937;
            border-color: #e5e7eb;
        }

        body.dark .deploy-table th {
            background: #0f172a;
            color: #f1f5f9;
            border-color: #334155;
        }

        body.light .deploy-table td {
            border-color: #e5e7eb;
        }

        body.dark .deploy-table td {
            border-color: #334155;
        }

        /* éƒ¨ç½²åœºæ™¯å¡ç‰‡ */
        .deploy-scene {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .scene-card {
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        body.light .scene-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
        }

        body.dark .scene-card {
            background: #0f172a;
            border: 1px solid #334155;
        }

        .scene-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body.dark .scene-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .scene-card h4 {
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #f97316;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .article-title {
                font-size: 28px;
            }

            .content-section {
                padding: 20px;
            }

            pre {
                padding: 16px;
                font-size: 13px;
            }

            .copy-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .deploy-table th, .deploy-table td {
                padding: 8px 10px;
                font-size: 14px;
            }

            .deploy-scene {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0 16px;
            }

            .toc {
                padding: 16px;
            }

            .article-title {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            h3 {
                font-size: 18px;
            }

            .deploy-table {
                font-size: 13px;
            }
        }

        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f97316;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
            z-index: 999;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: #ea580c;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="dark">
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">ä½•å“¥çš„åšå®¢</a>
            <ul class="nav-menu">
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="../index.html#projects">é¡¹ç›®æ¡ˆä¾‹</a></li>
                <li><a href="../index.html#experience">å·¥ä½œç»å†</a></li>
                <li><a href="../pages/articles.html">æŠ€æœ¯æ–‡ç« </a></li>
                <li><a href="../pages/about.html">å…³äºæˆ‘</a></li>
            </ul>
            <div class="theme-toggle" onclick="toggleTheme()"></div>
        </div>
    </nav>

    <main class="main-content">
        <!-- è¿”å›æŒ‰é’® -->
        <a href="../pages/articles.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
            <span>è¿”å›æ–‡ç« åˆ—è¡¨</span>
        </a>

        <!-- æ–‡ç« å¤´éƒ¨ -->
        <div class="article-header">
            <h1 class="article-title">ç”¨Pythonè‡ªåŠ¨åŒ–æ‰¹é‡éƒ¨ç½²æœåŠ¡å™¨</h1>
            <div class="article-meta">
                <span class="category-badge">Pythonè‡ªåŠ¨åŒ–</span>
                <span><i class="far fa-calendar"></i> 2025-12-15</span>
                <span><i class="far fa-clock"></i> é˜…è¯» 6 åˆ†é’Ÿ</span>
                <span><i class="far fa-eye"></i> 892 æ¬¡æµè§ˆ</span>
            </div>
        </div>

        <!-- æ–‡ç« ç®€ä»‹ -->
        <div class="article-intro">
            è¿ç»´100+å°æœåŠ¡å™¨æ—¶ï¼Œæ‰‹åŠ¨é…ç½®ç¯å¢ƒã€å®‰è£…è½¯ä»¶ã€éƒ¨ç½²æœåŠ¡çš„é‡å¤åŠ³åŠ¨è€—æ—¶åˆæ˜“å‡ºé”™ï¼æœ¬æ–‡åŸºäºå®æˆ˜ç»éªŒï¼Œåˆ†äº«ä¸€å¥—å¯ç›´æ¥å¤ç”¨çš„Pythonè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œå®ç°ä»æœåŠ¡å™¨åˆå§‹åŒ–ã€ç¯å¢ƒé…ç½®ã€è½¯ä»¶å®‰è£…åˆ°æœåŠ¡éƒ¨ç½²çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚åŒ…å«Paramikoæ‰¹é‡æ‰§è¡Œå‘½ä»¤ã€Fabric3æ‰¹é‡éƒ¨ç½²ã€é…ç½®æ–‡ä»¶ç®¡ç†ã€é”™è¯¯é‡è¯•ã€æ—¥å¿—è®°å½•ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¸®ä½ èŠ‚çœ90%çš„é‡å¤åŠ³åŠ¨ï¼Œ1å°æ—¶å®ŒæˆåŸæœ¬10å°æ—¶çš„éƒ¨ç½²å·¥ä½œã€‚
        </div>

        <!-- ç›®å½• -->
        <div class="toc">
            <h4>ğŸ“‹ æ–‡ç« ç›®å½•</h4>
            <ul>
                <li><a href="#prepare">ä¸€ã€æ‰¹é‡éƒ¨ç½²å‰çš„å‡†å¤‡å·¥ä½œ</a></li>
                <li><a href="#paramiko">äºŒã€åŸºäºParamikoçš„åŸºç¡€æ‰¹é‡æ“ä½œ</a></li>
                <li><a href="#fabric">ä¸‰ã€Fabric3è¿›é˜¶æ‰¹é‡éƒ¨ç½²</a></li>
                <li><a href="#config">å››ã€é…ç½®æ–‡ä»¶ç®¡ç†ä¸åŠ¨æ€å‚æ•°</a></li>
                <li><a href="#error">äº”ã€é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶</a></li>
                <li><a href="#log">å…­ã€éƒ¨ç½²æ—¥å¿—ä¸è¿›åº¦ç›‘æ§</a></li>
                <li><a href="#case">ä¸ƒã€å®æˆ˜æ¡ˆä¾‹ï¼š100+æœåŠ¡å™¨æ‰¹é‡éƒ¨ç½²Nginx</a></li>
                <li><a href="#optimize">å…«ã€æ€§èƒ½ä¼˜åŒ–ä¸å¤§è§„æ¨¡éƒ¨ç½²æŠ€å·§</a></li>
                <li><a href="#summary">ä¹ã€æ€»ç»“ä¸æ‰©å±•åœºæ™¯</a></li>
            </ul>
        </div>

        <!-- æ‰¹é‡éƒ¨ç½²å‰çš„å‡†å¤‡å·¥ä½œ -->
        <section class="content-section" id="prepare">
            <h2>ä¸€ã€æ‰¹é‡éƒ¨ç½²å‰çš„å‡†å¤‡å·¥ä½œ</h2>
            
            <h3>1. ç¯å¢ƒä¾èµ–å®‰è£…</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code># å®‰è£…æ ¸å¿ƒä¾èµ–åº“
pip install paramiko fabric3 pyyaml python-dotenv tqdm

# ä¾èµ–è¯´æ˜ï¼š
# paramikoï¼šSSHè¿æ¥æ ¸å¿ƒåº“ï¼Œå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ
# fabric3ï¼šåŸºäºparamikoçš„å°è£…ï¼Œç®€åŒ–æ‰¹é‡æ“ä½œ
# pyyamlï¼šé…ç½®æ–‡ä»¶è§£æï¼ˆæœåŠ¡å™¨åˆ—è¡¨ã€éƒ¨ç½²å‚æ•°ï¼‰
# python-dotenvï¼šç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆæ•æ„Ÿä¿¡æ¯å¦‚SSHå¯†ç ï¼‰
# tqdmï¼šè¿›åº¦æ¡æ˜¾ç¤ºï¼Œç›‘æ§éƒ¨ç½²è¿›åº¦</code></pre>
            </div>

            <h3>2. æœåŠ¡å™¨ä¿¡æ¯æ•´ç†</h3>
            <p>å°†æ‰€æœ‰æœåŠ¡å™¨ä¿¡æ¯æ•´ç†åˆ°YAMLé…ç½®æ–‡ä»¶ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç ï¼š</p>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code># servers.yaml æœåŠ¡å™¨é…ç½®æ–‡ä»¶
servers:
  # ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ç»„
  production:
    - host: 192.168.1.101
      port: 22
      username: root
      password: ${PROD_SSH_PWD}  # ä»ç¯å¢ƒå˜é‡è¯»å–å¯†ç 
      tags: ["web", "nginx"]
    - host: 192.168.1.102
      port: 22
      username: root
      password: ${PROD_SSH_PWD}
      tags: ["web", "nginx"]
    # æ›´å¤šç”Ÿäº§æœåŠ¡å™¨...
  
  # æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨ç»„
  test:
    - host: 192.168.2.101
      port: 22
      username: root
      password: ${TEST_SSH_PWD}
      tags: ["test", "nginx"]
    # æ›´å¤šæµ‹è¯•æœåŠ¡å™¨...

# .env ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆgitå¿½ç•¥ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼‰
PROD_SSH_PWD=ä½ çš„ç”Ÿäº§æœåŠ¡å™¨å¯†ç 
TEST_SSH_PWD=ä½ çš„æµ‹è¯•æœåŠ¡å™¨å¯†ç </code></pre>
            </div>

            <h3>3. SSHå…å¯†ç™»å½•é…ç½®ï¼ˆæ¨èï¼‰</h3>
            <div class="warning-tip">
                <strong>âš ï¸ å®‰å…¨æç¤º:</strong>
                <p>ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨SSHå¯†é’¥ç™»å½•ï¼Œè€Œéå¯†ç ç™»å½•ï¼ä»¥ä¸‹æ˜¯æ‰¹é‡é…ç½®å…å¯†ç™»å½•çš„è„šæœ¬ï¼š</p>
            </div>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code>#!/usr/bin/env python3
# ssh_key_deploy.py æ‰¹é‡é…ç½®SSHå…å¯†ç™»å½•
import os
import paramiko
import yaml
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
load_dotenv()
with open("servers.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

# æœ¬åœ°å…¬é’¥è·¯å¾„
PUBLIC_KEY_PATH = os.path.expanduser("~/.ssh/id_rsa.pub")

def deploy_ssh_key(host, port, username, password):
    """å‘å•å°æœåŠ¡å™¨éƒ¨ç½²SSHå…¬é’¥"""
    try:
        # è¯»å–æœ¬åœ°å…¬é’¥
        with open(PUBLIC_KEY_PATH, "r") as f:
            pub_key = f.read().strip()
        
        # å»ºç«‹SSHè¿æ¥
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(host, port=port, username=username, password=password, timeout=10)
        
        # æ‰§è¡Œå‘½ä»¤ï¼šåˆ›å»º.sshç›®å½•ï¼Œæ·»åŠ å…¬é’¥åˆ°authorized_keys
        commands = [
            "mkdir -p ~/.ssh && chmod 700 ~/.ssh",
            f'echo "{pub_key}" >> ~/.ssh/authorized_keys',
            "chmod 600 ~/.ssh/authorized_keys"
        ]
        
        for cmd in commands:
            stdin, stdout, stderr = ssh.exec_command(cmd)
            stdout.channel.recv_exit_status()  # ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆ
            if stderr.read():
                print(f"[{host}] æ‰§è¡Œå‘½ä»¤å¤±è´¥: {cmd}")
                return False
        
        ssh.close()
        print(f"[{host}] SSHå…å¯†ç™»å½•é…ç½®æˆåŠŸ")
        return True
    except Exception as e:
        print(f"[{host}] é…ç½®å¤±è´¥: {str(e)}")
        return False

if __name__ == "__main__":
    # éå†æ‰€æœ‰ç”Ÿäº§æœåŠ¡å™¨é…ç½®å…å¯†ç™»å½•
    for server in config["servers"]["production"]:
        # æ›¿æ¢ç¯å¢ƒå˜é‡
        password = os.environ.get(server["password"].replace("${", "").replace("}", ""))
        deploy_ssh_key(
            host=server["host"],
            port=server["port"],
            username=server["username"],
            password=password
        )</code></pre>
            </div>
        </section>

        <!-- åŸºäºParamikoçš„åŸºç¡€æ‰¹é‡æ“ä½œ -->
        <section class="content-section" id="paramiko">
            <h2>äºŒã€åŸºäºParamikoçš„åŸºç¡€æ‰¹é‡æ“ä½œ</h2>
            
            <h3>1. æ‰¹é‡æ‰§è¡Œå‘½ä»¤ï¼ˆæ ¸å¿ƒè„šæœ¬ï¼‰</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code>#!/usr/bin/env python3
# batch_execute.py æ‰¹é‡æ‰§è¡Œå‘½ä»¤
import os
import paramiko
import yaml
import threading
from dotenv import load_dotenv
from tqdm import tqdm  # è¿›åº¦æ¡

# åŠ è½½é…ç½®
load_dotenv()
with open("servers.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

# å…¨å±€å˜é‡ï¼šè¿›åº¦æ¡ã€é”
progress_bar = None
lock = threading.Lock()

def execute_command(server, commands, result_dict):
    """æ‰§è¡Œå•å°æœåŠ¡å™¨çš„å‘½ä»¤"""
    host = server["host"]
    try:
        # æ›¿æ¢å¯†ç ç¯å¢ƒå˜é‡
        password = os.environ.get(server["password"].replace("${", "").replace("}", ""))
        
        # å»ºç«‹SSHè¿æ¥
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(
            hostname=server["host"],
            port=server["port"],
            username=server["username"],
            password=password,
            timeout=15,
            allow_agent=False,
            look_for_keys=False
        )
        
        # æ‰§è¡Œå‘½ä»¤
        output = {}
        for cmd in commands:
            stdin, stdout, stderr = ssh.exec_command(cmd, get_pty=True)
            # è¯»å–è¾“å‡ºï¼ˆé¿å…ç¼“å†²åŒºæº¢å‡ºï¼‰
            stdout_content = stdout.read().decode("utf-8", errors="ignore")
            stderr_content = stderr.read().decode("utf-8", errors="ignore")
            output[cmd] = {
                "stdout": stdout_content,
                "stderr": stderr_content,
                "exit_code": stdout.channel.recv_exit_status()
            }
        
        ssh.close()
        
        # æ›´æ–°ç»“æœå’Œè¿›åº¦
        with lock:
            result_dict[host] = {"status": "success", "output": output}
            progress_bar.update(1)
    except Exception as e:
        with lock:
            result_dict[host] = {"status": "failed", "error": str(e)}
            progress_bar.update(1)

def batch_execute(server_group, commands, max_threads=10):
    """æ‰¹é‡æ‰§è¡Œå‘½ä»¤ï¼ˆå¤šçº¿ç¨‹ï¼‰"""
    global progress_bar
    servers = config["servers"][server_group]
    result_dict = {}
    
    # åˆå§‹åŒ–è¿›åº¦æ¡
    progress_bar = tqdm(total=len(servers), desc=f"æ‰¹é‡æ‰§è¡Œå‘½ä»¤ ({server_group})")
    
    # å¤šçº¿ç¨‹æ‰§è¡Œ
    threads = []
    semaphore = threading.Semaphore(max_threads)  # é™åˆ¶å¹¶å‘æ•°
    
    def worker(server):
        with semaphore:
            execute_command(server, commands, result_dict)
    
    for server in servers:
        t = threading.Thread(target=worker, args=(server,))
        threads.append(t)
        t.start()
    
    # ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    for t in threads:
        t.join()
    
    progress_bar.close()
    return result_dict

if __name__ == "__main__":
    # ç¤ºä¾‹ï¼šæ‰¹é‡åœ¨ç”Ÿäº§æœåŠ¡å™¨æ‰§è¡Œç³»ç»Ÿæ›´æ–°å’ŒæŸ¥çœ‹ç£ç›˜ç©ºé—´
    commands = [
        "yum update -y",
        "df -h",
        "free -m"
    ]
    
    # æ‰§è¡Œæ‰¹é‡å‘½ä»¤
    results = batch_execute("production", commands, max_threads=10)
    
    # è¾“å‡ºæ‰§è¡Œç»“æœ
    print("\n===== æ‰§è¡Œç»“æœæ±‡æ€» =====")
    success_count = 0
    failed_count = 0
    for host, result in results.items():
        if result["status"] == "success":
            success_count += 1
            print(f"âœ… {host}: æ‰§è¡ŒæˆåŠŸ")
        else:
            failed_count += 1
            print(f"âŒ {host}: æ‰§è¡Œå¤±è´¥ - {result['error']}")
    
    print(f"\næ€»è®¡: {success_count} å°æˆåŠŸ, {failed_count} å°å¤±è´¥")</code></pre>
            </div>

            <h3>2. æ‰¹é‡ä¸Šä¼ æ–‡ä»¶</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code>def upload_file(server, local_path, remote_path):
    """ä¸Šä¼ æ–‡ä»¶åˆ°å•å°æœåŠ¡å™¨"""
    host = server["host"]
    try:
        # æ›¿æ¢å¯†ç ç¯å¢ƒå˜é‡
        password = os.environ.get(server["password"].replace("${", "").replace("}", ""))
        
        # å»ºç«‹SFTPè¿æ¥
        transport = paramiko.Transport((host, server["port"]))
        transport.connect(username=server["username"], password=password)
        sftp = paramiko.SFTPClient.from_transport(transport)
        
        # ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒç›®å½•é€’å½’ä¸Šä¼ ï¼‰
        if os.path.isdir(local_path):
            # é€’å½’åˆ›å»ºè¿œç¨‹ç›®å½•
            sftp.mkdir(remote_path, mode=0o755)
            for root, dirs, files in os.walk(local_path):
                # è®¡ç®—ç›¸å¯¹è·¯å¾„
                rel_path = os.path.relpath(root, local_path)
                remote_dir = os.path.join(remote_path, rel_path)
                
                # åˆ›å»ºè¿œç¨‹å­ç›®å½•
                if rel_path != ".":
                    try:
                        sftp.mkdir(remote_dir, mode=0o755)
                    except IOError:
                        pass  # ç›®å½•å·²å­˜åœ¨
                
                # ä¸Šä¼ æ–‡ä»¶
                for file in files:
                    local_file = os.path.join(root, file)
                    remote_file = os.path.join(remote_dir, file)
                    sftp.put(local_file, remote_file)
        else:
            # ä¸Šä¼ å•ä¸ªæ–‡ä»¶
            sftp.put(local_path, remote_path)
        
        sftp.close()
        transport.close()
        
        with lock:
            progress_bar.update(1)
        return True
    except Exception as e:
        print(f"[{host}] æ–‡ä»¶ä¸Šä¼ å¤±è´¥: {str(e)}")
        with lock:
            progress_bar.update(1)
        return False

# æ‰¹é‡ä¸Šä¼ æ–‡ä»¶è°ƒç”¨ç¤ºä¾‹
def batch_upload(server_group, local_path, remote_path, max_threads=10):
    servers = config["servers"][server_group]
    global progress_bar
    progress_bar = tqdm(total=len(servers), desc=f"æ‰¹é‡ä¸Šä¼ æ–‡ä»¶ ({server_group})")
    
    threads = []
    semaphore = threading.Semaphore(max_threads)
    
    def worker(server):
        with semaphore:
            upload_file(server, local_path, remote_path)
    
    for server in servers:
        t = threading.Thread(target=worker, args=(server,))
        threads.append(t)
        t.start()
    
    for t in threads:
        t.join()
    
    progress_bar.close()

# è°ƒç”¨ç¤ºä¾‹ï¼šæ‰¹é‡ä¸Šä¼ Nginxé…ç½®æ–‡ä»¶åˆ°æ‰€æœ‰ç”Ÿäº§æœåŠ¡å™¨
if __name__ == "__main__":
    batch_upload(
        server_group="production",
        local_path="./nginx_config",
        remote_path="/etc/nginx/conf.d",
        max_threads=10
    )</code></pre>
            </div>
        </section>

        <!-- Fabric3è¿›é˜¶æ‰¹é‡éƒ¨ç½² -->
        <section class="content-section" id="fabric">
            <h2>ä¸‰ã€Fabric3è¿›é˜¶æ‰¹é‡éƒ¨ç½²</h2>
            
            <h3>1. Fabric3æ ¸å¿ƒä¼˜åŠ¿</h3>
            <div class="deploy-scene">
                <div class="scene-card">
                    <h4><i class="fas fa-code"></i> è¯­æ³•æ›´ç®€æ´</h4>
                    <p>åŸºäºè£…é¥°å™¨çš„è¯­æ³•ï¼Œä¸€è¡Œä»£ç å®ç°æ‰¹é‡æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†SSHè¿æ¥</p>
                </div>
                <div class="scene-card">
                    <h4><i class="fas fa-tasks"></i> å†…ç½®æ‰¹é‡åŠŸèƒ½</h4>
                    <p>åŸç”Ÿæ”¯æŒå¤šæœåŠ¡å™¨æ‰¹é‡æ‰§è¡Œï¼Œå†…ç½®å¹¶è¡Œæ‰§è¡Œã€å¤±è´¥é‡è¯•ç­‰æœºåˆ¶</p>
                </div>
                <div class="scene-card">
                    <h4><i class="fas fa-file-upload"></i> æ–‡ä»¶æ“ä½œä¾¿æ·</h4>
                    <p>ç®€åŒ–çš„æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½APIï¼Œæ”¯æŒæœ¬åœ°-è¿œç¨‹æ–‡ä»¶åŒæ­¥</p>
                </div>
            </div>

            <h3>2. Fabric3æ‰¹é‡éƒ¨ç½²è„šæœ¬</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code># fabfile.py Fabric3éƒ¨ç½²è„šæœ¬
from fabric import Connection, task
from fabric.exceptions import GroupException
from invoke.exceptions import UnexpectedExit
import yaml
import os
from dotenv import load_dotenv

# åŠ è½½é…ç½®
load_dotenv()
with open("servers.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

# æ„å»ºæœåŠ¡å™¨è¿æ¥åˆ—è¡¨
def get_connections(server_group):
    """è·å–æœåŠ¡å™¨è¿æ¥åˆ—è¡¨"""
    connections = []
    for server in config["servers"][server_group]:
        # æ›¿æ¢å¯†ç ç¯å¢ƒå˜é‡
        password = os.environ.get(server["password"].replace("${", "").replace("}", ""))
        # åˆ›å»ºè¿æ¥
        conn = Connection(
            host=server["host"],
            port=server["port"],
            user=server["username"],
            connect_kwargs={"password": password}
        )
        connections.append(conn)
    return connections

# æ‰¹é‡å®‰è£…Nginx
@task
def install_nginx(ctx, env="production"):
    """æ‰¹é‡å®‰è£…Nginx"""
    connections = get_connections(env)
    print(f"å¼€å§‹åœ¨{env}ç¯å¢ƒçš„{len(connections)}å°æœåŠ¡å™¨å®‰è£…Nginx...")
    
    # å¹¶è¡Œæ‰§è¡Œå®‰è£…å‘½ä»¤
    try:
        for conn in connections:
            # å®‰è£…ä¾èµ–
            conn.run("yum install -y gcc pcre-devel zlib-devel openssl-devel", hide=True)
            # ä¸‹è½½å¹¶ç¼–è¯‘å®‰è£…Nginx
            conn.run("wget http://nginx.org/download/nginx-1.24.0.tar.gz -P /tmp", hide=True)
            conn.run("cd /tmp && tar -zxvf nginx-1.24.0.tar.gz", hide=True)
            conn.run(
                "cd /tmp/nginx-1.24.0 && ./configure --prefix=/usr/local/nginx --with-http_ssl_module && make && make install",
                hide=True
            )
            # åˆ›å»ºç³»ç»ŸæœåŠ¡
            conn.run("""
                cat > /usr/lib/systemd/system/nginx.service << EOF
[Unit]
Description=nginx - high performance web server
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s stop
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF
            """, hide=True)
            # å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
            conn.run("systemctl daemon-reload && systemctl start nginx && systemctl enable nginx", hide=True)
            print(f"âœ… {conn.host}: Nginxå®‰è£…æˆåŠŸ")
    except GroupException as e:
        for conn, exc in e.result.items():
            print(f"âŒ {conn.host}: Nginxå®‰è£…å¤±è´¥ - {exc}")
    except UnexpectedExit as e:
        print(f"å‘½ä»¤æ‰§è¡Œå¤±è´¥: {e}")

# æ‰¹é‡éƒ¨ç½²Nginxé…ç½®
@task
def deploy_nginx_config(ctx, env="production"):
    """æ‰¹é‡éƒ¨ç½²Nginxé…ç½®æ–‡ä»¶"""
    connections = get_connections(env)
    print(f"å¼€å§‹å‘{env}ç¯å¢ƒéƒ¨ç½²Nginxé…ç½®...")
    
    for conn in connections:
        # ä¸Šä¼ é…ç½®æ–‡ä»¶
        conn.put("./nginx.conf", "/usr/local/nginx/conf/nginx.conf", preserve_mode=True)
        # éªŒè¯é…ç½®å¹¶é‡å¯
        result = conn.run("/usr/local/nginx/sbin/nginx -t", warn=True)
        if result.ok:
            conn.run("systemctl restart nginx")
            print(f"âœ… {conn.host}: Nginxé…ç½®éƒ¨ç½²æˆåŠŸ")
        else:
            print(f"âŒ {conn.host}: Nginxé…ç½®éªŒè¯å¤±è´¥ - {result.stderr}")

# æ‰¹é‡æ£€æŸ¥æœåŠ¡çŠ¶æ€
@task
def check_nginx_status(ctx, env="production"):
    """æ‰¹é‡æ£€æŸ¥NginxçŠ¶æ€"""
    connections = get_connections(env)
    print(f"æ£€æŸ¥{env}ç¯å¢ƒNginxçŠ¶æ€...")
    
    for conn in connections:
        result = conn.run("systemctl is-active nginx", warn=True)
        if result.stdout.strip() == "active":
            print(f"âœ… {conn.host}: Nginxè¿è¡Œæ­£å¸¸")
        else:
            print(f"âŒ {conn.host}: Nginxæœªè¿è¡Œ - {result.stdout}")

# å‘½ä»¤è¡Œè°ƒç”¨ç¤ºä¾‹ï¼š
# fab install_nginx --env=production    # ç”Ÿäº§ç¯å¢ƒæ‰¹é‡å®‰è£…Nginx
# fab deploy_nginx_config --env=test    # æµ‹è¯•ç¯å¢ƒéƒ¨ç½²é…ç½®
# fab check_nginx_status --env=production  # æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒNginxçŠ¶æ€</code></pre>
            </div>
        </section>

        <!-- é…ç½®æ–‡ä»¶ç®¡ç†ä¸åŠ¨æ€å‚æ•° -->
        <section class="content-section" id="config">
            <h2>å››ã€é…ç½®æ–‡ä»¶ç®¡ç†ä¸åŠ¨æ€å‚æ•°</h2>
            
            <h3>1. æ¨¡æ¿åŒ–é…ç½®æ–‡ä»¶ï¼ˆJinja2ï¼‰</h3>
            <div class="code-container">
                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶ä»£ç </button>
                <pre><code># 1. å®‰è£…Jinja2
# pip install jinja2

# 2. Nginxé…ç½®æ¨¡æ¿ (nginx_template.conf)
'''
worker_processes {{ worker_processes }};  # åŠ¨æ€å‚æ•°ï¼šCPUæ ¸å¿ƒæ•°
error_log /var/log/nginx/error.log {{ log_level }};

events {
    worker_connections {{ worker_connections }};
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    
    sendfile        on;
    keepalive_timeout  65;
    
    {% for server in servers %}
    server {
        listen       {{ server.port }};
        server_name  {{ server.domain }};
        
        location / {
            proxy_pass http://{{ server.upstream }};
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        access_log /var/log/nginx/{{ server.domain }}.log;
    }
    {% endfor %}
}
'''

# 3. åŠ¨æ€æ¸²æŸ“é…ç½®æ–‡ä»¶è„šæœ¬
import jinja2
import yaml

def render_config_template(template_path, config_path, output_path):
"""æ¸²æŸ“é…ç½®æ¨¡æ¿"""
# åŠ è½½æ¨¡æ¿
env = jinja2.Environment(loader=jinja2.FileSystemLoader("."))
template = env.get_template(template_path)

# åŠ è½½é…ç½®ï¼ˆä»YAMLæ–‡ä»¶è¯»å–åŠ¨æ€å‚æ•°ï¼‰
with open(config_path, "r", encoding="utf-8") as f:
    config_data = yaml.safe_load(f)

# å¯é€‰ï¼šåŠ¨æ€è·å–æœåŠ¡å™¨CPUæ ¸å¿ƒæ•°ï¼ˆç”¨äºworker_processeså‚æ•°ï¼‰
def get_cpu_cores():
    """è·å–æœ¬åœ°CPUæ ¸å¿ƒæ•°ï¼ˆè‹¥éƒ¨ç½²åˆ°è¿œç¨‹å¯é€šè¿‡SSHæ‰§è¡Œnprocå‘½ä»¤ï¼‰"""
    import multiprocessing
    return multiprocessing.cpu_count()

# è¡¥å……åŠ¨æ€å‚æ•°
config_data["worker_processes"] = config_data.get("worker_processes", get_cpu_cores())
config_data["log_level"] = config_data.get("log_level", "warn")
config_data["worker_connections"] = config_data.get("worker_connections", 1024)

# æ¸²æŸ“æ¨¡æ¿å¹¶è¾“å‡ºæ–‡ä»¶
with open(output_path, "w", encoding="utf-8") as f:
    rendered_content = template.render(**config_data)
    f.write(rendered_content)

print(f"âœ… é…ç½®æ¨¡æ¿æ¸²æŸ“å®Œæˆï¼Œè¾“å‡ºæ–‡ä»¶ï¼š{output_path}")

# ========== é…ç½®æ–‡ä»¶ç¤ºä¾‹ (nginx_config.yaml) ==========
'''
# nginx_config.yaml åŠ¨æ€é…ç½®å‚æ•°
worker_processes: 4  # è‹¥ä¸æŒ‡å®šåˆ™è‡ªåŠ¨è·å–CPUæ ¸å¿ƒæ•°
log_level: info
worker_connections: 2048
servers:
  - port: 80
    domain: www.example.com
    upstream: 127.0.0.1:8080
  - port: 443
    domain: www.example.com
    upstream: 127.0.0.1:8080
    ssl: true
    ssl_cert: /etc/nginx/certs/example.crt
    ssl_key: /etc/nginx/certs/example.key
'''

# ========== è°ƒç”¨ç¤ºä¾‹ ==========
if __name__ == "__main__":
    # æ¸²æŸ“Nginxé…ç½®æ¨¡æ¿
    render_config_template(
        template_path="nginx_template.conf",  # æ¨¡æ¿æ–‡ä»¶è·¯å¾„
        config_path="nginx_config.yaml",      # é…ç½®å‚æ•°æ–‡ä»¶
        output_path="nginx.conf"              # æ¸²æŸ“åçš„è¾“å‡ºæ–‡ä»¶
    )
    
    # æ¸²æŸ“å®Œæˆåï¼Œå¯ç›´æ¥è°ƒç”¨ä¹‹å‰çš„æ‰¹é‡ä¸Šä¼ å‡½æ•°éƒ¨ç½²åˆ°æœåŠ¡å™¨
    # batch_upload("production", "./nginx.conf", "/usr/local/nginx/conf/nginx.conf")
